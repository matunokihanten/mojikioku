<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>簡単な逆算チャレンジ</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      text-align: center;
    }
    #numbers-container > span {
      display: inline-block;
      margin: 0.5rem;
      font-size: 1.5rem;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
    }
    button {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <h1>簡単な逆算チャレンジ</h1>
  <p id="target">目標: ?</p>
  <p id="current-sum">現在の合計: ?</p>
  <div id="numbers-container"></div>
  <p id="message"></p>
  <button id="new-challenge">新しいチャレンジ</button>

  <script>
    // グローバル変数 puzzle に現在のパズル情報を保持
    let puzzle = {};

    // パズル生成関数
    // 5つの数字を生成し、各数字には「解答用の符号」（+ または -）をランダムに割り当て、
    // その合計を「目標」として設定します。
    // 初期状態はすべてが + なので、初期合計と目標が同じにならないようにします。
    function generatePuzzle() {
      let numbers = [];
      let initialSum = 0;
      let target = 0;
      do {
        numbers = [];
        initialSum = 0;
        target = 0;
        for (let i = 0; i < 5; i++) {
          // 数字は 1～9 の範囲
          const num = Math.floor(Math.random() * 9) + 1;
          // 解答用の符号：ランダムに + (1) か - (-1) を割り当てる
          const solSign = Math.random() < 0.5 ? 1 : -1;
          numbers.push({
            value: num,
            solutionSign: solSign,  // ※内部情報（今回は使用しませんが、拡張のヒントに）
            currentSign: 1          // 初期状態は全て+1
          });
          initialSum += num;
          target += solSign * num;
        }
        // すべてが + の場合、初期合計と目標が同じになってしまうので再生成
      } while (target === initialSum || target <= 0);
      puzzle.numbers = numbers;
      puzzle.initialSum = initialSum;
      puzzle.target = target;
    }

    // パズル内容を HTML 上に表示
    function displayPuzzle() {
      const targetElem = document.getElementById("target");
      const currentSumElem = document.getElementById("current-sum");
      const numbersContainer = document.getElementById("numbers-container");
      const messageElem = document.getElementById("message");
      
      numbersContainer.innerHTML = "";
      messageElem.innerText = "";
      
      targetElem.innerText = "目標: " + puzzle.target;
      currentSumElem.innerText = "現在の合計: " + puzzle.initialSum;
      
      // 各数字は span 要素として表示し、クリックで符号が切り替わる
      puzzle.numbers.forEach((item, index) => {
        const span = document.createElement("span");
        span.innerText = "+" + item.value;
        span.dataset.index = index;
        span.addEventListener("click", function() {
          toggleNumber(index);
        });
        numbersContainer.appendChild(span);
      });
    }

    // 現在の合計を計算し、画面に表示する。目標と一致したら「正解！」のメッセージも表示。
    function updateCurrentSumAndCheck() {
      const currentSumElem = document.getElementById("current-sum");
      const messageElem = document.getElementById("message");
      let currentSum = puzzle.numbers.reduce((acc, item) => acc + item.currentSign * item.value, 0);
      currentSumElem.innerText = "現在の合計: " + currentSum;
      if (currentSum === puzzle.target) {
        messageElem.innerText = "正解！";
      } else {
        messageElem.innerText = "";
      }
    }

    // 数字の符号を切り替える関数
    // クリックされた数字が + なら - に、- なら + に変更し、現在の合計を更新する
    function toggleNumber(index) {
      puzzle.numbers[index].currentSign *= -1;
      const numbersContainer = document.getElementById("numbers-container");
      const span = numbersContainer.querySelector('span[data-index="' + index + '"]');
      if (puzzle.numbers[index].currentSign === 1) {
        span.innerText = "+" + puzzle.numbers[index].value;
      } else {
        span.innerText = "-" + puzzle.numbers[index].value;
      }
      updateCurrentSumAndCheck();
    }

    // ボタンのイベント
    document.getElementById("new-challenge").addEventListener("click", function() {
      generatePuzzle();
      displayPuzzle();
    });

    // ページ読み込み時に初期パズルを生成
    window.onload = function() {
      generatePuzzle();
      displayPuzzle();
    }
  </script>
</body>
</html>