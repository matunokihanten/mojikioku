<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ラーメン作りゲーム（ドラッグ＆ドロップ版）</title>
  <style>
    :root {
      --button-padding: 15px 30px;
      --button-font-size: 24px;
      --input-font-size: 22px;
      --label-font-size: 20px;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
    }
    #game-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    #start-options {
      text-align: center;
      margin-bottom: 25px;
      font-size: 20px;
    }
    #start-options label, #start-options select {
      margin: 0 15px;
      padding: 8px;
      font-size: 18px;
    }
    #ticket {
      border: 2px solid #aadddd;
      background-color: #fff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 25px;
      margin: 30px auto;
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      white-space: pre-line;
      width: 90%;
      border-radius: 8px;
    }
    #timer-display {
      text-align: center;
      font-size: 26px;
      font-weight: bold;
      margin-top: 15px;
      color: #d9534f;
      display: none;
    }
    #scoreboard {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      margin-top: 20px;
      color: #5cb85c;
    }
    #difficulty-status {
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      margin-top: 8px;
      color: #007bff;
      display: none;
    }
    #message {
      font-size: 28px;
      text-align: center;
      margin-top: 30px;
      font-weight: bold;
    }
    /* ドラッグ可能な要素 */
    .draggable-item {
      padding: 12px 18px;
      font-size: 18px;
      border-radius: 6px;
      cursor: grab;
      transition: opacity 0.2s ease, transform 0.1s ease;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    .draggable-item:active {
      cursor: grabbing;
    }
    .menu-item { background-color: #e0e0e0; color: #333; }
    .menu-item.black-ramen { background-color: #c0c0c0; color: #333; }
    .spiciness-item { background-color: #d9534f; color: #fff; }
    .noodle-item { background-color: #5cb85c; color: #fff; }
    /* ドラッグ中の要素のスタイル */
    .dragging {
      opacity: 0.5;
    }
    /* ドロップエリア */
    .drop-area {
      min-height: 50px;
      border: 2px dashed #ccc;
      border-radius: 4px;
      padding: 10px;
      text-align: center;
      line-height: 50px;
      margin-top: 12px;
      font-size: var(--input-font-size);
      color: #777;
      transition: background-color 0.2s ease, border-color 0.2s ease;
      font-weight: bold;
    }
    /* ドロップ可能状態のスタイル */
    .drop-area.drag-over {
      background-color: #e9f5ff;
      border-color: #007bff;
    }
    .order-input-area {
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 8px;
    }
    .order-input-area h3 {
      margin-top: 0;
      text-align: center;
      font-size: 26px;
      color: #333;
    }
    .fields-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    .field-item {
      flex: 1;
      min-width: 280px;
      display: flex;
      flex-direction: column;
    }
    .field-item label {
      margin-bottom: 10px;
      font-weight: bold;
      font-size: var(--label-font-size);
      color: #555;
    }
    .menu-buttons-container, .spiciness-buttons-container, .noodle-buttons-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    /* ... (その他のスタイルは省略) ... */
    #start-button {
      font-size: var(--button-font-size);
      padding: var(--button-padding);
      margin: 25px;
      cursor: pointer;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 6px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: background-color 0.2s ease, transform 0.1s ease;
    }
    #start-button:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }
    #start-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    #action-buttons {
      text-align: center;
      margin-top: 30px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
    }
    #action-buttons button {
      font-size: var(--button-font-size);
      padding: var(--button-padding);
      margin: 5px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background-color 0.2s ease, transform 0.1s ease;
    }
    #exit-button { background-color: #f0ad4e; color: #fff; }
    #exit-button:hover { background-color: #ec971f; transform: translateY(-2px); }
    #exit-button:active { transform: translateY(0); box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    #hint-button { background-color: #17a2b8; color: #fff; }
    #hint-button:hover { background-color: #138496; transform: translateY(-2px); }
    #hint-button:active { transform: translateY(0); box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    #hint-button:disabled { background-color: #cccccc; cursor: not-allowed; }
    #answer-button { background-color: #6c757d; color: #fff; }
    #answer-button:hover { background-color: #5a6268; transform: translateY(-2px); }
    #answer-button:active { transform: translateY(0); box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    #answer-button:disabled { background-color: #cccccc; cursor: not-allowed; }
    #submit-button { background-color: #28a745; color: #fff; }
    #submit-button:hover { background-color: #218838; transform: translateY(-2px); }
    #submit-button:active { transform: translateY(0); box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    #difficulty-up-button, #difficulty-down-button {
      background-color: #6f42c1;
      color: #fff;
    }
    #difficulty-up-button:hover, #difficulty-down-button:hover {
      background-color: #5931a9;
      transform: translateY(-2px);
    }
    #difficulty-up-button:active, #difficulty-down-button:active {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    .menu-buttons-container, .spiciness-buttons-container, .noodle-buttons-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .spiciness-buttons-container, .noodle-buttons-container {
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    }
    @media (max-width: 768px) {
      :root {
        --button-padding: 10px 18px;
        --button-font-size: 16px;
        --input-font-size: 16px;
        --label-font-size: 16px;
      }
      #game-container {
        padding: 15px;
      }
      #ticket {
        font-size: 22px;
        padding: 15px;
      }
      #timer-display, #scoreboard, #message, #difficulty-status {
        font-size: 18px;
      }
      .menu-buttons-container, .spiciness-buttons-container, .noodle-buttons-container {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 8px;
      }
      .field-item {
        min-width: 100%;
      }
      .draggable-item {
        padding: 8px 12px;
        font-size: 14px;
      }
      #action-buttons button {
        display: block;
        width: 80%;
        margin: 8px auto;
      }
      .drop-area {
        min-height: 40px;
        line-height: 40px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="start-options">
      <label for="difficulty-select">難易度:</label>
      <select id="difficulty-select">
        <option value="easy">簡単</option>
        <option value="normal" selected>普通</option>
        <option value="hard">難しい</option>
      </select>
      <label for="order-count-select">注文数:</label>
      <select id="order-count-select">
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
      <label for="theme-select">テーマ:</label>
      <select id="theme-select">
        <option value="default" selected>デフォルト</option>
        <option value="lightblue">ライトブルー</option>
        <option value="lightgreen">ライトグリーン</option>
        <option value="lightpink">ライトピンク</option>
      </select>
    </div>
    <div style="text-align: center;">
      <button id="start-button" onclick="startGame()">スタート</button>
    </div>
    <div id="scoreboard">正解数: 0</div>
    <div id="difficulty-status">現在の難易度: 普通</div>
    <div id="ticket" style="display:none;"></div>
    <div id="timer-display"></div>
    <div id="orders-input-container" style="display:none;"></div>
    <div id="action-buttons">
      <button id="exit-button" onclick="exitGame()">終了</button>
      <button id="difficulty-up-button" onclick="adjustDifficulty(1)">難易度UP</button>
      <button id="difficulty-down-button" onclick="adjustDifficulty(-1)">難易度DOWN</button>
      <button id="hint-button" onclick="useHint()">ヒント</button>
      <button id="answer-button" onclick="showAnswer()">答え</button>
      <button id="submit-button" onclick="submitOrder()">完了</button>
    </div>
    <div id="message"></div>
  </div>

  <script>
    let correctCount = 0;
    let currentTickets = [];
    let ticketTimer;
    let countdownInterval;
    let ticketDisplayTimeBase;
    const MIN_TICKET_DISPLAY_TIME = 4000;
    let hintUsed = false;
    let ticketIsVisible = false;

    const difficulties = ["easy", "normal", "hard"];
    let currentDifficultyIndex = 1;

    const baseMenus = ["担々麺", "きのこ入り担々麺", "ねぎ担々麺", "叉焼入り担々麺", "もやし入り担々麺", "トンカツ入り担々麺", "豚角煮入り担々麺"];
    const blackMenus = ["黒担々麺", "黒きのこ担々麺", "黒ねぎ担々麺", "黒叉焼担々麺", "黒もやし担々麺", "黒トンカツ担々麺", "黒角煮担々麺"];
    const hardAdditionalMenus = ["味噌担々麺", "塩担々麺", "醤油担々麺", "濃厚担々麺"];

    const spicinessLevels = ["ちょい辛", "並辛", "大辛", "激辛"];
    const noodleOptions = ["普通", "硬め", "柔らかめ"];

    let currentAvailableMenus = [];
    let currentOrderCount = 2;
    
    // ドラッグ＆ドロップ関連の関数
    function allowDrop(event) {
      event.preventDefault();
      event.target.classList.add('drag-over');
    }

    function removeDragOver(event) {
      event.target.classList.remove('drag-over');
    }

    function drag(event) {
      // ドラッグする要素の情報をデータとしてセット
      event.dataTransfer.setData("text", event.target.innerText);
      event.dataTransfer.setData("type", event.target.dataset.type);
      event.target.classList.add('dragging');
    }

    function dragEnd(event) {
      event.target.classList.remove('dragging');
    }

    function drop(event) {
      event.preventDefault();
      event.target.classList.remove('drag-over');
      const data = event.dataTransfer.getData("text");
      const type = event.dataTransfer.getData("type");
      const targetId = event.target.id;
      
      // ドロップされた要素が正しいタイプかどうかチェック
      if (!targetId.includes(type)) {
        document.getElementById("message").innerText = "不正解：正しい入力欄にドラッグしてください！";
        document.getElementById("message").style.color = "red";
        return;
      }
      
      // ドロップエリアに値をセット
      event.target.innerText = data;
    }

    function startGame() {
      const initialDifficulty = document.getElementById("difficulty-select").value;
      currentDifficultyIndex = difficulties.indexOf(initialDifficulty);

      currentOrderCount = parseInt(document.getElementById("order-count-select").value, 10);

      updateDifficultySettings();

      const theme = document.getElementById("theme-select").value;
      let bgColor = "#fff";
      if (theme === "lightblue") {
        bgColor = "#e0f7fa";
        document.getElementById("ticket").style.borderColor = "#a7d9e4";
      } else if (theme === "lightgreen") {
        bgColor = "#e8f5e9";
        document.getElementById("ticket").style.borderColor = "#aed6b2";
      } else if (theme === "lightpink") {
        bgColor = "#fce4ec";
        document.getElementById("ticket").style.borderColor = "#f7b2c5";
      } else {
        document.getElementById("ticket").style.borderColor = "#aadddd";
      }
      document.getElementById("ticket").style.backgroundColor = bgColor;
      
      document.getElementById("start-options").style.display = "none";
      document.getElementById("start-button").style.display = "none";
      document.getElementById("action-buttons").style.display = "flex";
      document.getElementById("ticket").style.display = "block";
      document.getElementById("orders-input-container").style.display = "block";
      document.getElementById("message").innerText = "";
      document.getElementById("difficulty-status").style.display = "block";
      
      correctCount = 0;
      updateScoreboard();
      generateOrdersInputUI();
      showTicket();
    }

    function updateDifficultySettings() {
      const difficulty = difficulties[currentDifficultyIndex];
      if (difficulty === "easy") {
        ticketDisplayTimeBase = 12000 + (currentOrderCount - 1) * 6000;
        currentAvailableMenus = baseMenus.slice(0, 4);
      } else if (difficulty === "normal") {
        ticketDisplayTimeBase = 10000 + (currentOrderCount - 1) * 5000;
        currentAvailableMenus = baseMenus.concat(blackMenus);
      } else if (difficulty === "hard") {
        ticketDisplayTimeBase = 8000 + (currentOrderCount - 1) * 4000;
        currentAvailableMenus = baseMenus.concat(blackMenus, hardAdditionalMenus);
      }
      updateDifficultyStatus();
    }

    function adjustDifficulty(change) {
      currentDifficultyIndex += change;
      if (currentDifficultyIndex < 0) {
        currentDifficultyIndex = difficulties.length - 1;
      } else if (currentDifficultyIndex >= difficulties.length) {
        currentDifficultyIndex = 0;
      }
      updateDifficultySettings();
      document.getElementById("message").innerText = `難易度が「${getDifficultyName(difficulties[currentDifficultyIndex])}」に変更されました！`;
      document.getElementById("message").style.color = "blue";
      generateOrdersInputUI();
    }

    function updateDifficultyStatus() {
      const difficultyName = getDifficultyName(difficulties[currentDifficultyIndex]);
      document.getElementById("difficulty-status").innerText = `現在の難易度: ${difficultyName}`;
    }

    function getDifficultyName(difficultyValue) {
      switch(difficultyValue) {
        case "easy": return "簡単";
        case "normal": return "普通";
        case "hard": return "難しい";
        default: return "";
      }
    }

    function showTicket() {
      if (ticketTimer) clearTimeout(ticketTimer);
      if (countdownInterval) clearInterval(countdownInterval);

      hintUsed = false;
      document.getElementById("hint-button").disabled = false;
      document.getElementById("answer-button").disabled = false;

      let dynamicDisplayTime = Math.max(ticketDisplayTimeBase - (correctCount * 500), MIN_TICKET_DISPLAY_TIME);

      currentTickets = [];
      let ticketText = "";
      for (let i = 0; i < currentOrderCount; i++) {
        let randomMenu = currentAvailableMenus[Math.floor(Math.random() * currentAvailableMenus.length)];
        let randomSpiciness = spicinessLevels[Math.floor(Math.random() * spicinessLevels.length)];
        let randomNoodle = noodleOptions[Math.floor(Math.random() * noodleOptions.length)];
        let order = {
          menu: randomMenu,
          spiciness: randomSpiciness,
          noodle: randomNoodle
        };
        currentTickets.push(order);
        ticketText += `注文${i + 1}: ${randomMenu} (${randomSpiciness}, ${randomNoodle})\n`;
      }

      const ticketDiv = document.getElementById("ticket");
      ticketDiv.innerText = ticketText;
      ticketDiv.style.display = "block";
      ticketIsVisible = true;

      const timerDisplay = document.getElementById("timer-display");
      timerDisplay.style.display = "block";
      let startTime = Date.now();
      countdownInterval = setInterval(() => {
        let elapsed = Date.now() - startTime;
        let remaining = Math.max(dynamicDisplayTime - elapsed, 0);
        timerDisplay.innerText = "残り時間: " + (remaining / 1000).toFixed(1) + "秒";
        if (remaining <= 0) {
          clearInterval(countdownInterval);
          ticketDiv.style.display = "none";
          ticketIsVisible = false;
          timerDisplay.style.display = "none";
        }
      }, 100);

      clearInputFields();
    }

    function clearInputFields() {
      for (let i = 0; i < currentOrderCount; i++) {
        document.getElementById(`drop-area-${i}-menu`).innerText = "メニューをドロップ";
        document.getElementById(`drop-area-${i}-spiciness`).innerText = "辛さをドロップ";
        document.getElementById(`drop-area-${i}-noodle`).innerText = "硬さをドロップ";
      }
    }

    function generateOrdersInputUI() {
      const container = document.getElementById("orders-input-container");
      while (container.firstChild) {
        container.removeChild(container.firstChild);
      }
      
      const menuButtonsContainer = createDraggableContainer("メニュー", "menu", currentAvailableMenus, "menu-item");
      container.appendChild(menuButtonsContainer);
      
      const spicinessButtonsContainer = createDraggableContainer("辛さ", "spiciness", spicinessLevels, "spiciness-item");
      container.appendChild(spicinessButtonsContainer);

      const noodleButtonsContainer = createDraggableContainer("硬さ", "noodle", noodleOptions, "noodle-item");
      container.appendChild(noodleButtonsContainer);

      for (let i = 0; i < currentOrderCount; i++) {
        const orderBlock = document.createElement("div");
        orderBlock.className = "order-input-area";

        const header = document.createElement("h3");
        header.innerText = `注文 ${i + 1}`;
        orderBlock.appendChild(header);

        const fieldsRow = document.createElement("div");
        fieldsRow.className = "fields-row";

        const fieldMenu = createDropArea("メニュー", `order-${i}-menu`);
        const fieldSpiciness = createDropArea("辛さ", `order-${i}-spiciness`);
        const fieldNoodle = createDropArea("硬さ", `order-${i}-noodle`);

        fieldsRow.appendChild(fieldMenu);
        fieldsRow.appendChild(fieldSpiciness);
        fieldsRow.appendChild(fieldNoodle);

        orderBlock.appendChild(fieldsRow);
        container.appendChild(orderBlock);
      }
    }
    
    function createDraggableContainer(title, type, options, className) {
      const container = document.createElement("div");
      container.className = `${type}-buttons-container`;

      options.forEach(option => {
        const item = document.createElement("div");
        item.innerText = option;
        item.className = `draggable-item ${className}`;
        item.draggable = true;
        item.dataset.type = type;
        item.ondragstart = drag;
        item.ondragend = dragEnd;
        if (option.startsWith("黒")) {
          item.classList.add("black-ramen");
        }
        container.appendChild(item);
      });

      return container;
    }

    function createDropArea(label, id) {
      const fieldItem = document.createElement("div");
      fieldItem.className = "field-item";

      const labelEl = document.createElement("label");
      labelEl.innerText = label + ":";
      fieldItem.appendChild(labelEl);

      const dropArea = document.createElement("div");
      dropArea.className = "drop-area";
      dropArea.id = `drop-area-${id}`;
      dropArea.innerText = `${label}をドロップ`;
      dropArea.dataset.type = label === "メニュー" ? "menu" : label === "辛さ" ? "spiciness" : "noodle";
      dropArea.ondragover = allowDrop;
      dropArea.ondragleave = removeDragOver;
      dropArea.ondrop = drop;
      fieldItem.appendChild(dropArea);

      return fieldItem;
    }
    
    function submitOrder() {
      let allCorrect = true;
      const messageDiv = document.getElementById("message");

      for (let i = 0; i < currentOrderCount; i++) {
        const orderData = currentTickets[i];
        const menuInput = document.getElementById(`drop-area-order-${i}-menu`).innerText.trim();
        const spicinessInput = document.getElementById(`drop-area-order-${i}-spiciness`).innerText.trim();
        const noodleInput = document.getElementById(`drop-area-order-${i}-noodle`).innerText.trim();

        if (menuInput !== orderData.menu ||
            spicinessInput !== orderData.spiciness ||
            noodleInput !== orderData.noodle) {
          allCorrect = false;
          break;
        }
      }

      if (allCorrect) {
        correctCount++;
        updateScoreboard();
        messageDiv.innerText = "正解です！次の問題です！";
        messageDiv.style.color = "green";
        showTicket();
      } else {
        messageDiv.innerText = "不正解：全ての項目を正しく入力してください！";
        messageDiv.style.color = "red";
      }
    }

    function useHint() {
      if (hintUsed) return;
      hintUsed = true;
      document.getElementById("hint-button").disabled = true;

      if (ticketTimer) clearTimeout(ticketTimer);
      if (countdownInterval) clearInterval(countdownInterval);

      const ticketDiv = document.getElementById("ticket");
      ticketDiv.style.display = "block";
      ticketIsVisible = true;

      const hintDisplayTime = 3000;
      ticketTimer = setTimeout(() => {
        ticketDiv.style.display = "none";
        ticketIsVisible = false;
      }, hintDisplayTime);

      const timerDisplay = document.getElementById("timer-display");
      timerDisplay.style.display = "block";
      let startTime = Date.now();
      countdownInterval = setInterval(() => {
        let elapsed = Date.now() - startTime;
        let remaining = Math.max(hintDisplayTime - elapsed, 0);
        timerDisplay.innerText = "ヒント残り時間: " + (remaining / 1000).toFixed(1) + "秒";
        if (remaining <= 0) {
          clearInterval(countdownInterval);
          timerDisplay.style.display = "none";
        }
      }, 100);
    }

    function showAnswer() {
      if (ticketTimer) {
        clearTimeout(ticketTimer);
        ticketTimer = null;
      }
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
        document.getElementById("timer-display").style.display = "none";
      }
      document.getElementById("ticket").style.display = "block";
      ticketIsVisible = true;
      document.getElementById("answer-button").disabled = true;
    }

    function updateScoreboard() {
      document.getElementById("scoreboard").innerText = `正解数: ${correctCount}`;
    }

    function exitGame() {
      document.getElementById("start-options").style.display = "block";
      document.getElementById("start-button").style.display = "inline-block";
      document.getElementById("action-buttons").style.display = "none";
      document.getElementById("ticket").style.display = "none";
      document.getElementById("orders-input-container").style.display = "none";
      document.getElementById("message").innerText = "";
      document.getElementById("timer-display").style.display = "none";
      document.getElementById("difficulty-status").style.display = "none";
      if (ticketTimer) clearTimeout(ticketTimer);
      if (countdownInterval) clearInterval(countdownInterval);
      correctCount = 0;
      updateScoreboard();
      const container = document.getElementById("orders-input-container");
      while (container.firstChild) {
        container.removeChild(container.firstChild);
      }
    }
  </script>
</body>
</html>
