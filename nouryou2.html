<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>脳梁トレーニングアプリ</title>
  <style>
    /* 縦画面スクロール無効化 */
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      touch-action: none;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
    }
    .container {
      width: 100%;
      max-width: 900px;
      height: 100%;
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      padding: 20px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }
    h1 {
      font-size: 2.5em;
      color: #2c5282;
      text-align: center;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.15);
      margin-bottom: 10px;
    }
    .subtitle {
      font-size: 1.2em;
      color: #718096;
      text-align: center;
      margin-bottom: 20px;
    }
    .game-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
      gap: 12px;
      margin-bottom: 12px;
    }
    .game-btn {
      background: linear-gradient(45deg,#667eea,#764ba2);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 12px;
      font-size: 1em;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      transition: transform .1s, box-shadow .1s;
      touch-action: manipulation;
    }
    .game-btn:active {
      transform: scale(.96);
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }
    .game-area {
      flex: 1;
      display: none;
      opacity: 0;
      transition: opacity .3s;
      flex-direction: column;
      overflow: hidden;
    }
    .game-area.active {
      display: flex;
      opacity: 1;
    }
    .score, .timer {
      font-size: 1.2em;
      font-weight: bold;
      margin: 4px 0;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }
    .score { color: #2c5282; }
    .timer { color: #e53e3e; }
    .instructions {
      background: #e6fffa;
      padding: 12px;
      border-left: 4px solid #38b2ac;
      border-radius: 10px;
      font-size: .9em;
      line-height: 1.4;
      margin-bottom: 8px;
    }
    /* --- Dual Tap --- */
    .dual-tap {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: space-around;
    }
    .tap-area {
      width: 100px;
      height: 100px;
      background: #999;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: bold;
      color: white;
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
      transition: transform .1s, box-shadow .1s;
      touch-action: manipulation;
      user-select: none;
    }
    .tap-area:active {
      transform: scale(.94);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    .left-tap { background: linear-gradient(45deg,#ff6b6b,#ee5a24); }
    .right-tap{ background: linear-gradient(45deg,#4ecdc4,#44a08d); }
    #tap-instruction {
      text-align: center;
      font-size: 1em;
      font-weight: bold;
      color: #3a0ca3;
      margin: 6px 0;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%,100%{opacity:1}50%{opacity:.7}
    }
    /* --- Color-Word --- */
    .color-word {
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      padding: 12px;
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      margin: 12px 0;
      flex-shrink: 0;
    }
    .color-options {
      display: grid;
      grid-template-columns: repeat(4,1fr);
      gap:8px;
      margin:8px 0;
    }
    .color-btn {
      padding:8px;
      border:none;
      border-radius:8px;
      font-size:1em;
      font-weight:bold;
      color:white;
      box-shadow:0 4px 12px rgba(0,0,0,0.2);
      transition:transform .1s,box-shadow .1s;
      touch-action:manipulation;
    }
    .color-btn:active {
      transform:scale(.96);
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
    }
    /* --- Dual Draw --- */
    .drawing-area {
      flex:1;
      display:flex;
      justify-content:space-around;
      align-items:center;
      gap:8px;
    }
    .canvas-container {
      flex:1;
      text-align:center;
    }
    canvas {
      width:100%;
      max-width:150px;
      height:auto;
      border:2px solid #cce0ff;
      border-radius:10px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
      touch-action:none;
    }
    .canvas-label {
      margin-top:4px;
      font-size:.9em;
      color:#3182ce;
      font-weight:bold;
    }
    .clear-btn {
      padding:8px;
      border:none;
      border-radius:8px;
      background:#90cdf4;
      color:#2a4365;
      font-size:1em;
      font-weight:bold;
      align-self:center;
      margin:8px 0;
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
      transition:transform .1s,box-shadow .1s;
      touch-action:manipulation;
    }
    .clear-btn:active {
      transform:scale(.96);
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }
    /* --- Calculation --- */
    .calculation-area {
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .calc-display {
      font-size:2em;
      font-weight:bold;
      padding:12px;
      background:white;
      border:2px solid #f6e05e;
      color:#a07900;
      border-radius:10px;
      text-align:center;
      width:100%;
      max-width:250px;
    }
    .calc-options {
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:8px;
      width:100%;
      max-width:250px;
    }
    .calc-btn {
      padding:8px;
      border:none;
      border-radius:8px;
      font-size:1em;
      font-weight:bold;
      background:linear-gradient(45deg,#667eea,#764ba2);
      color:white;
      box-shadow:0 4px 12px rgba(0,0,0,0.2);
      transition:transform .1s,box-shadow .1s;
      touch-action:manipulation;
    }
    .calc-btn:active {
      transform:scale(.96);
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
    }
    .back-btn {
      position:absolute;
      top:8px; left:8px;
      padding:8px;
      border:none;
      border-radius:8px;
      background:#718096;
      color:white;
      font-size:1em;
      font-weight:bold;
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
      transition:transform .1s,box-shadow .1s;
      touch-action:manipulation;
    }
    .back-btn:active {
      transform:scale(.96);
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }
    .game-over-message {
      font-size:1.2em;
      font-weight:bold;
      color:#dd6b20;
      background:rgba(255,245,230,0.8);
      padding:8px;
      border-radius:8px;
      text-align:center;
      margin-top:4px;
      display:none;
    }
    .feedback-correct { color:#38a169; }
    .feedback-incorrect { color:#e53e3e; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🧠 脳梁トレーニングアプリ</h1>
    <p class="subtitle">左右の脳を同時に使って、脳梁を活性化させましょう！</p>

    <div id="menu" class="game-selector">
      <button class="game-btn" onclick="startGame('dual-tap')">左右同時タップ</button>
      <button class="game-btn" onclick="startGame('color-word')">色と文字の不一致</button>
      <button class="game-btn" onclick="startGame('dual-draw')">左右手同時描画</button>
      <button class="game-btn" onclick="startGame('calculation')">左右脳連携計算</button>
    </div>

    <div id="dual-tap" class="game-area">
      <div class="instructions">表示される指示に従い、左右を同時にタップしましょう。</div>
      <div class="score">スコア: <span id="tap-score">0</span></div>
      <div class="timer">残り時間: <span id="tap-timer">30</span>秒</div>
      <div id="tap-instruction"></div>
      <div class="dual-tap">
        <div class="tap-area left-tap" id="leftTap">左</div>
        <div class="tap-area right-tap" id="rightTap">右</div>
      </div>
      <div class="game-over-message" id="tap-game-over"></div>
    </div>

    <div id="color-word" class="game-area">
      <div class="instructions">文字の意味ではなく、文字の色を答えてください。</div>
      <div class="score">スコア: <span id="color-score">0</span></div>
      <div class="timer">残り時間: <span id="color-timer">30</span>秒</div>
      <div class="color-word" id="color-display"></div>
      <div class="color-options">
        <button class="color-btn" id="btn-red" style="background:#e53e3e">赤</button>
        <button class="color-btn" id="btn-green" style="background:#38a169">緑</button>
        <button class="color-btn" id="btn-blue" style="background:#3182ce">青</button>
        <button class="color-btn" id="btn-yellow" style="background:#d69e2e">黄</button>
      </div>
      <div class="game-over-message" id="color-game-over"></div>
    </div>

    <div id="dual-draw" class="game-area">
      <div class="instructions">左右のキャンバスに図形を同時に描いてください。</div>
      <div class="score">スコア: <span id="draw-score">0</span></div>
      <div class="timer">残り時間: <span id="draw-timer">60</span>秒</div>
      <div class="drawing-area">
        <div class="canvas-container">
          <canvas id="leftCanvas" width="200" height="200"></canvas>
          <div class="canvas-label">左手: 円</div>
        </div>
        <div class="canvas-container">
          <canvas id="rightCanvas" width="200" height="200"></canvas>
          <div class="canvas-label">右手: 四角</div>
        </div>
      </div>
      <button class="clear-btn" onclick="clearDraw()">クリア</button>
      <div class="game-over-message" id="draw-game-over"></div>
    </div>

    <div id="calculation" class="game-area">
      <div class="instructions">表示される計算式の答えを選択してください。</div>
      <div class="score">スコア: <span id="calc-score">0</span></div>
      <div class="timer">残り時間: <span id="calc-timer">30</span>秒</div>
      <div class="calculation-area">
        <div class="calc-display" id="calc-display"></div>
        <div class="calc-options" id="calc-options"></div>
      </div>
      <div class="game-over-message" id="calc-game-over"></div>
    </div>

    <button class="back-btn" id="back-to-menu" onclick="showMenu()" style="display:none">メニューに戻る</button>
  </div>

  <script>
    const gameElements = {
      'dual-tap':    { score:'tap-score',    timer:'tap-timer',    over:'tap-game-over' },
      'color-word':  { score:'color-score',  timer:'color-timer',  over:'color-game-over' },
      'dual-draw':   { score:'draw-score',   timer:'draw-timer',   over:'draw-game-over' },
      'calculation': { score:'calc-score',   timer:'calc-timer',   over:'calc-game-over'}
    };
    let currentGame=null, timerId=null, correctAns=0;
    const scores={'dual-tap':0,'color-word':0,'dual-draw':0,'calculation':0};
    const durations={'dual-tap':30,'color-word':30,'dual-draw':60,'calculation':30};

    function startGame(type){
      currentGame=type;
      document.getElementById('menu').style.display='none';
      document.getElementById(type).classList.add('active');
      document.getElementById('back-to-menu').style.display='block';
      scores[type]=0; updateScore(type); resetOver(type);
      clearInterval(timerId);
      startTimer(type, durations[type]);
      if(type==='dual-tap') initDualTap();
      if(type==='color-word') initColor();
      if(type==='dual-draw') initDraw();
      if(type==='calculation') genCalc();
    }

    function showMenu(){
      currentGame=null;
      document.getElementById('menu').style.display='grid';
      document.querySelectorAll('.game-area').forEach(a=>a.classList.remove('active'));
      document.getElementById('back-to-menu').style.display='none';
      clearInterval(timerId);
    }

    function updateScore(t){ document.getElementById(gameElements[t].score).textContent=scores[t]; }
    function resetOver(t){
      let el=document.getElementById(gameElements[t].over);
      el.style.display='none'; el.textContent='';
    }
    function showOver(t){
      let el=document.getElementById(gameElements[t].over);
      el.textContent=`時間切れ！最終スコア: ${scores[t]}`; el.style.display='block';
    }
    function startTimer(t,sec){
      let left=sec, te=document.getElementById(gameElements[t].timer);
      timerId=setInterval(()=>{
        left--; te.textContent=left;
        if(left<=0){
          clearInterval(timerId);
          showOver(t);
          setTimeout(()=>{ alert(`時間切れ！ ${t} のスコア: ${scores[t]}`); showMenu(); },1000);
        }
      },1000);
    }

    /* --- Dual Tap --- */
    let tapIdx=0;
    const tapIns=[
      {txt:'左右同時にタップ！', tgt:'both'},
      {txt:'左だけタップ！',    tgt:'left'},
      {txt:'右だけタップ！',    tgt:'right'},
      {txt:'同時にタップ！',    tgt:'both'},
      {txt:'右だけ素早く！',    tgt:'right'},
      {txt:'正確に両方！',      tgt:'both'}
    ];
    function initDualTap(){
      tapIdx=0; scores['dual-tap']=0; updateScore('dual-tap');
      showNext();
      ['leftTap','rightTap'].forEach(id=>{
        const el=document.getElementById(id);
        el.ontouchstart=el.onclick=null;
        el.addEventListener('touchstart',e=>{ e.preventDefault(); handleTap(id==='leftTap'?'left':'right', e.touches); });
        el.addEventListener('click', ()=>handleTap(id==='leftTap'?'left':'right'));
      });
    }
    function showNext(){
      if(currentGame!=='dual-tap') return;
      const ins=tapIns[tapIdx%tapIns.length];
      const el=document.getElementById('tap-instruction');
      el.textContent=ins.txt; el.dataset.tgt=ins.tgt;
      setTimeout(()=>{ tapIdx++; showNext(); }, ins.tgt==='both'?2000:1400);
    }
    function handleTap(side,touches){
      if(currentGame!=='dual-tap') return;
      const el=document.getElementById('tap-instruction');
      const tgt=el.dataset.tgt;
      let pts=0;
      if(tgt==='both' && touches&&touches.length>=2) pts=20;
      else if(tgt==='both') pts=-5;
      else if(tgt===side) pts=10;
      else pts=-3;
      scores['dual-tap']=Math.max(0,scores['dual-tap']+pts); updateScore('dual-tap');
      const btn=document.querySelector(side==='left'?'.left-tap':'.right-tap');
      btn.classList.add(pts>=0?'feedback-correct':'feedback-incorrect');
      setTimeout(()=>btn.classList.remove('feedback-correct','feedback-incorrect'),200);
    }

    /* --- Color-Word --- */
    const cols=['red','green','blue','yellow'];
    const names=['赤','緑','青','黄'];
    const vals=['#e53e3e','#38a169','#3182ce','#d69e2e'];
    function initColor(){
      scores['color-word']=0; updateScore('color-word');
      showColorWord();
      cols.forEach(c=>{
        const btn=document.getElementById('btn-'+c);
        btn.onclick=()=>selectColor(c);
        btn.ontouchstart=e=>{ e.preventDefault(); selectColor(c); };
      });
    }
    function showColorWord(){
      const iTxt=Math.floor(Math.random()*4);
      const iCol=Math.floor(Math.random()*4);
      const disp=document.getElementById('color-display');
      disp.textContent=names[iTxt];
      disp.style.color=vals[iCol];
      disp.dataset.correctColorName=cols[iCol];
    }
    function selectColor(chosen){
      if(currentGame!=='color-word') return;
      const disp=document.getElementById('color-display');
      const ok=disp.dataset.correctColorName;
      const pts=(chosen===ok?10:-3);
      scores['color-word']=Math.max(0,scores['color-word']+pts); updateScore('color-word');
      const feedbackClass = pts >= 0 ? 'feedback-correct' : 'feedback-incorrect';
      document.querySelectorAll('.color-btn').forEach(btn => {
        if (btn.id === 'btn-' + chosen) {
          btn.classList.add(feedbackClass);
        }
      });
      setTimeout(()=>{
        document.querySelectorAll('.color-btn').forEach(btn => {
          btn.classList.remove('feedback-correct', 'feedback-incorrect');
        });
        if(pts>=0) showColorWord();
      },400);
    }

    /* --- Dual Draw --- */
    let lCtx, rCtx, cntL=0, cntR=0;
    function initDraw(){
      scores['dual-draw']=0; updateScore('dual-draw');
      cntL=cntR=0;
      const lc=document.getElementById('leftCanvas'), rc=document.getElementById('rightCanvas');
      lCtx=lc.getContext('2d'); rCtx=rc.getContext('2d');
      lCtx.clearRect(0,0,lc.width,lc.height); rCtx.clearRect(0,0,rc.width,rc.height);
      [lc,rc].forEach(cv=>{
        const isL=cv.id==='leftCanvas';
        cv.ontouchstart=cv.onmousedown=null;
        cv.addEventListener('touchstart',e=>{ e.preventDefault(); drawShape(isL,e.touches[0]); });
        cv.addEventListener('mousedown',e=>drawShape(isL,e));
      });
      document.querySelector('.clear-btn').onclick=clearDraw;
    }
    function drawShape(isLeft,e){
      if(isLeft&&cntL>=10) return; if(!isLeft&&cntR>=10) return;
      const ctx=isLeft?lCtx:rCtx;
      const rect=e.target.getBoundingClientRect();
      const x=e.clientX-rect.left, y=e.clientY-rect.top;
      ctx.beginPath();
      if(isLeft){ ctx.arc(x,y,20,0,2*Math.PI); ctx.fillStyle='#ff6b6b'; cntL++;
      } else { ctx.fillStyle='#4ecdc4'; ctx.fillRect(x-20,y-20,40,40); cntR++; }
      ctx.fill();
      if(cntL>=10&&cntR>=10){
        scores['dual-draw']+=50; updateScore('dual-draw');
        alert('描画完了！ボーナス50点獲得！');
      }
    }
    function clearDraw(){
      const lc=document.getElementById('leftCanvas'), rc=document.getElementById('rightCanvas');
      lCtx.clearRect(0,0,lc.width,lc.height); rCtx.clearRect(0,0,rc.width,rc.height);
      cntL=cntR=0;
    }

    /* --- Calculation --- */
    function genCalc(){
      scores['calculation']=0; updateScore('calculation');
      let n1=Math.floor(Math.random()*15)+1, n2=Math.floor(Math.random()*15)+1;
      const ops=['+','-','×','÷'], op=ops[Math.floor(Math.random()*4)];
      if(op==='-'&&n1<n2) [n1,n2]=[n2,n1];
      if(op==='÷'){ const d=Math.floor(Math.random()*9)+1; n1=d*(Math.floor(Math.random()*9)+1); n2=d; }
      document.getElementById('calc-display').textContent=`${n1}${op}${n2}`;
      switch(op){
        case '+': correctAns=n1+n2; break;
        case '-': correctAns=n1-n2; break;
        case '×': correctAns=n1*n2; break;
        case '÷': correctAns=n1/n2; break;
      }
      const wrong=[];
      while(wrong.length<2){
        const c=(op==='÷'? correctAns+Math.floor(Math.random()*4)-2
                         : correctAns+Math.floor(Math.random()*5)-2);
        if(c>0&&c!==correctAns&&!wrong.includes(c)) wrong.push(c);
      }
      const opts=[correctAns,...wrong].sort(()=>Math.random()-0.5);
      const cont=document.getElementById('calc-options');
      cont.innerHTML='';
      opts.forEach(v=>{
        const btn=document.createElement('button');
        btn.className='calc-btn'; btn.textContent=v;
        btn.onclick=btn.ontouchstart=e=>{ e.preventDefault(); pickCalc(v); };
        cont.appendChild(btn);
      });
    }
    function pickCalc(sel){
      if(currentGame!=='calculation') return;
      const pts=(sel===correctAns?10:-3);
      scores['calculation']=Math.max(0,scores['calculation']+pts); updateScore('calculation');
      document.querySelectorAll('#calc-options .calc-btn').forEach(b=>{
        const v=Number(b.textContent);
        if(v===correctAns) b.classList.add('feedback-correct');
        else if(v===sel)   b.classList.add('feedback-incorrect');
      });
      setTimeout(()=>{
        document.querySelectorAll('.calc-btn').forEach(b=>b.classList.remove('feedback-correct','feedback-incorrect'));
        if(pts>0) genCalc();
      },400);
    }
  </script>
</body>
</html>
