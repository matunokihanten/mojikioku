<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ•°å­—è¨˜æ†¶ã‚²ãƒ¼ãƒ </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
/* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒªã‚»ãƒƒãƒˆ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  /* ã‚¿ãƒƒãƒ—æ™‚ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ç„¡åŠ¹åŒ– */
  -webkit-tap-highlight-color: transparent;
}

html, body {
  height: 100%;
  overflow: hidden; /* ãƒšãƒ¼ã‚¸å…¨ä½“ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ */
}

body {
  background: #e8f0f4;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  color: #333;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ã‚²ãƒ¼ãƒ å…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
.container {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 10px;
  width: 100%;
  max-width: 400px; /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å‘ã‘ã«å¹…ã‚’èª¿æ•´ */
  margin: auto;
  display: flex;
  flex-direction: column;
  /* ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ãªã©ã‚’è€ƒæ…®ã—ãŸç”»é¢é«˜ã•ã«è¿½å¾“ */
  height: 100vh;
  height: 100dvh; 
}

/* ä¸Šéƒ¨ã®è¨­å®šãƒãƒ¼ */
.settings-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  border-bottom: 1px solid #eee;
  flex-shrink: 0; /* ã“ã®ã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’å›ºå®š */
}

.settings-bar h1 {
  font-size: 1.2em;
  color: #006d77;
  margin-right: 10px;
}

.settings-bar label {
  font-size: 0.9em;
  margin-right: 5px;
}

.settings-bar select {
  padding: 4px 8px;
  border: 1px solid #bbb;
  border-radius: 6px;
  font-size: 0.9em;
}

.settings-bar button {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #83c5be;
  color: white;
  font-weight: bold;
  transition: background 0.2s ease;
  font-size: 0.9em;
  margin-left: auto;
}

.settings-bar button:hover {
  background: #5aa399;
}

/* ã‚²ãƒ¼ãƒ è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
#instruction {
  font-size: 1.2em;
  margin: 5px 0;
  font-weight: bold;
  text-align: center;
  flex-shrink: 0;
}

#numberDisplay {
  font-size: 2.8em;
  font-weight: bold;
  color: #006d77;
  min-height: 45px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

#prompt {
  font-size: 0.9em;
  margin-bottom: 5px;
  text-align: center;
  min-height: 1.2em;
  flex-shrink: 0;
}

#userInput {
  font-size: 1.5em;
  padding: 5px;
  width: 70%;
  margin: 0 auto 5px auto;
  text-align: center;
  border: 1px solid #aaa;
  border-radius: 6px;
  background-color: #f9f9f9;
  flex-shrink: 0;
}

#status {
  font-size: 1em;
  margin-bottom: 5px;
  text-align: center;
  min-height: 1.2em;
  font-weight: bold;
  flex-shrink: 0;
}

/* å±¥æ­´è¡¨ç¤ºã‚¨ãƒªã‚¢ - æ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¨ã¦ä½¿ç”¨ */
#historyContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
  grid-gap: 4px;
  padding: 5px;
  border: 1px solid #ddd;
  border-radius: 6px;
  background: #fafafa;
  flex: 1; /* â˜… ã“ã®è¨­å®šã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ä¸»å½¹ã«ãªã‚Šã¾ã™ */
  overflow-y: auto; /* å†…å®¹ãŒå¢—ãˆãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
}

.history-number {
  font-size: 0.9em;
  font-weight: bold;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  text-align: center;
}

.history-number.correct { background: #d4edda; color: #155724; }
.history-number.incorrect { background: #f8d7da; color: #721c24; }

/* ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ */
#keypad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 5px;
  width: 100%;
  max-width: 280px;
  margin: 10px auto;
  flex-shrink: 0;
}

#keypad button {
  background: #edf6f9;
  color: #333;
  font-size: 1.5em;
  font-weight: bold;
  padding: 10px 0;
  border: 1px solid #bbb;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
}

#keypad button:hover {
  background: #dcefee;
}

#keypad button.clear-button { background: #ffddd2; }
#keypad button.clear-button:hover { background: #ffc2b2; }

/* ä¸‹éƒ¨ã®ãƒœã‚¿ãƒ³ */
#gameButtons {
  display: flex;
  justify-content: center;
  padding: 5px 0;
  flex-shrink: 0;
}

#showAnswerButton {
  width: 80%;
  max-width: 280px;
  padding: 8px;
  font-size: 1em;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #e5989b;
  color: white;
  font-weight: bold;
  transition: background 0.2s ease;
}

#showAnswerButton:hover {
  background: #d96e71;
}

</style>
</head>
<body>

<div class="container">
  <div class="settings-bar">
    <h1>æ•°å­—è¨˜æ†¶</h1>
    <div>
      <label for="digitSelect">æ¡æ•°:</label>
      <select id="digitSelect">
        <option value="2">2æ¡</option>
        <option value="3">3æ¡</option>
        <option value="4">4æ¡</option>
        <option value="5">5æ¡</option>
      </select>
    </div>
    <button id="startButton">é–‹å§‹</button>
  </div>

  <div id="instruction">æ•°å­—ã‚’è¦šãˆã¦ã­</div>
  <div id="numberDisplay">&nbsp;</div>
  <div id="prompt"></div>
  <input type="text" id="userInput" readonly placeholder="å…¥åŠ›">
  <div id="status"></div>
  <div id="historyContainer"></div>
  <div id="keypad"></div>
  <div id="gameButtons">
    <button id="showAnswerButton">ç­”ãˆã‚’è¦‹ã‚‹</button>
  </div>
</div>

<script>
// DOMè¦ç´ ã®å–å¾—
const digitSelect = document.getElementById("digitSelect");
const startButton = document.getElementById("startButton");
const showAnswerButton = document.getElementById("showAnswerButton");
const instructionElem = document.getElementById("instruction");
const numberDisplayElem = document.getElementById("numberDisplay");
const promptElem = document.getElementById("prompt");
const userInputElem = document.getElementById("userInput");
const statusElem = document.getElementById("status");
const historyContainer = document.getElementById("historyContainer");
const keypad = document.getElementById("keypad");

// ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°
let digitCount = 2;
let round = 1;
let prevNumber = "";
let currentNumber = "";
let allowInput = false;
let answerRevealed = false;
let isGameActive = false;
let gameTimeout; // setTimeoutã®IDã‚’ä¿æŒ

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
startButton.addEventListener("click", toggleGame);
showAnswerButton.addEventListener("click", showAnswer);

// åˆæœŸè¨­å®š
createKeypad();
resetUI(); // åˆæœŸUIçŠ¶æ…‹ã‚’è¨­å®š

/**
 * ã‚²ãƒ¼ãƒ ã®é–‹å§‹ã¨ãƒªã‚»ãƒƒãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
 */
function toggleGame() {
    if (isGameActive) {
        if (confirm("ç¾åœ¨ã®ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
            resetGame();
        }
    } else {
        startGame();
    }
}

/**
 * ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
 */
function startGame() {
    isGameActive = true;
    startButton.textContent = "ãƒªã‚»ãƒƒãƒˆ";
    digitSelect.disabled = true; // ã‚²ãƒ¼ãƒ ä¸­ã¯æ¡æ•°å¤‰æ›´ã‚’ä¸å¯ã«

    digitCount = parseInt(digitSelect.value, 10);
    round = 1;
    prevNumber = "";
    currentNumber = "";
    allowInput = false;
    answerRevealed = false;

    historyContainer.innerHTML = "";
    userInputElem.value = "";
    statusElem.textContent = "";

    startRound();
}

/**
 * ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€åˆæœŸçŠ¶æ…‹ã«æˆ»ã™é–¢æ•°
 */
function resetGame() {
    clearTimeout(gameTimeout); // é€²è¡Œä¸­ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
    isGameActive = false;
    resetUI();
}

/**
 * UIã‚’ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®çŠ¶æ…‹ã«æˆ»ã™é–¢æ•°
 */
function resetUI() {
    startButton.textContent = "é–‹å§‹";
    digitSelect.disabled = false;
    instructionElem.textContent = "æ¡æ•°ã‚’é¸ã‚“ã§ã€Œé–‹å§‹ã€ã‚’æŠ¼ã—ã¦ã­";
    numberDisplayElem.innerHTML = "&nbsp;";
    promptElem.textContent = "";
    userInputElem.value = "";
    statusElem.textContent = "";
    historyContainer.innerHTML = "";
    allowInput = false;
}

/**
 * ã€Œç­”ãˆã‚’è¦‹ã‚‹ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
 */
function showAnswer() {
    if (!allowInput || !isGameActive) return;
    answerRevealed = true;
    statusElem.textContent = "ç­”ãˆ: " + prevNumber;
    statusElem.style.color = "#006600";
}

/**
 * æ•°å­—ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
 */
function createKeypad() {
    keypad.innerHTML = "";
    // 1-9ã®ãƒœã‚¿ãƒ³
    for (let num = 1; num <= 9; num++) {
        const btn = document.createElement("button");
        btn.textContent = num;
        btn.addEventListener("click", () => appendDigit(num));
        keypad.appendChild(btn);
    }
    // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³
    const clearBtn = document.createElement("button");
    clearBtn.textContent = "C";
    clearBtn.className = "clear-button";
    clearBtn.addEventListener("click", clearInput);
    keypad.appendChild(clearBtn);
    // 0ã®ãƒœã‚¿ãƒ³
    const btn0 = document.createElement("button");
    btn0.textContent = "0";
    btn0.addEventListener("click", () => appendDigit(0));
    keypad.appendChild(btn0);
    // ãƒ€ãƒŸãƒ¼ã®ãƒœã‚¿ãƒ³ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ç”¨ï¼‰
    const dummyBtn = document.createElement("button");
    dummyBtn.style.visibility = "hidden";
    keypad.appendChild(dummyBtn);
}

/**
 * æŒ‡å®šã•ã‚ŒãŸæ¡æ•°ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å€¤ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
 * @param {number} digits - ç”Ÿæˆã™ã‚‹æ•°å€¤ã®æ¡æ•°
 * @returns {string} ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å€¤ã®æ–‡å­—åˆ—
 */
function generateRandomNumber(digits) {
    if (digits < 1) return "0";
    const min = Math.pow(10, digits - 1);
    const max = Math.pow(10, digits) - 1;
    return String(Math.floor(Math.random() * (max - min + 1)) + min);
}

/**
 * æ–°ã—ã„ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
 */
function startRound() {
    if (!isGameActive) return;

    statusElem.textContent = "";
    promptElem.textContent = "";
    userInputElem.value = "";
    allowInput = false;
    answerRevealed = false;

    currentNumber = generateRandomNumber(digitCount);

    instructionElem.textContent = (round === 1) ? "æœ€åˆã®æ•°å­—ã‚’è¦šãˆã¦ã­" : "æ¬¡ã®æ•°å­—ã‚’è¦šãˆã¦â€¦";
    numberDisplayElem.textContent = currentNumber;

    // 3ç§’é–“æ•°å­—ã‚’è¡¨ç¤º
    gameTimeout = setTimeout(() => {
        if (!isGameActive) return;
        numberDisplayElem.innerHTML = "&nbsp;";
        
        if (round === 1) {
            // æœ€åˆã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¯è¦šãˆã‚‹ã ã‘
            prevNumber = currentNumber;
            round++;
            startRound(); // ã™ãã«æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
        } else {
            // 2ãƒ©ã‚¦ãƒ³ãƒ‰ç›®ä»¥é™ã¯å…¥åŠ›ãƒ•ã‚§ãƒ¼ã‚ºã¸
            allowInput = true;
            instructionElem.textContent = "ã€ç›´å‰ã®æ•°å­—ã€‘ã‚’å…¥åŠ›ï¼";
            promptElem.textContent = `(ä»Šè¦šãˆã‚‹æ•°å­—: ${currentNumber})`;
        }
    }, 3000);
}

/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«æ•°å­—ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
 * @param {number} digit - å…¥åŠ›ã•ã‚ŒãŸæ•°å­—
 */
function appendDigit(digit) {
    if (!allowInput || !isGameActive) return;
    if (answerRevealed) {
        statusElem.textContent = "";
        answerRevealed = false;
    }
    
    if (userInputElem.value.length < digitCount) {
        userInputElem.value += digit.toString();
    }
    
    // å…¥åŠ›ãŒå®Œäº†ã—ãŸã‚‰è‡ªå‹•ã§ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
    if (userInputElem.value.length === digitCount) {
        gameTimeout = setTimeout(checkAnswer, 200);
    }
}

/**
 * å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹é–¢æ•°
 */
function clearInput() {
    if (!allowInput || !isGameActive) return;
    userInputElem.value = "";
    statusElem.textContent = "";
    answerRevealed = false;
}

/**
 * ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
 */
function checkAnswer() {
    if (!isGameActive) return;
    allowInput = false; // ãƒã‚§ãƒƒã‚¯ä¸­ã¯å…¥åŠ›ã‚’ç¦æ­¢

    if (userInputElem.value === prevNumber) {
        statusElem.textContent = "æ­£è§£ï¼ğŸ‰";
        statusElem.style.color = "#006600";
        addToHistory(prevNumber, true);
    } else {
        statusElem.textContent = "ä¸æ­£è§£â€¦ æ­£è§£ã¯ " + prevNumber;
        statusElem.style.color = "#cc0000";
        addToHistory(prevNumber, false);
    }
    
    // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã®æº–å‚™
    prevNumber = currentNumber;
    round++;

    // 1.5ç§’å¾Œã«æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
    gameTimeout = setTimeout(() => {
        if (!isGameActive) return;
        startRound();
    }, 1500);
}

/**
 * çµæœã‚’å±¥æ­´ã«è¿½åŠ ã™ã‚‹é–¢æ•°
 * @param {string} num - å¯¾è±¡ã®æ•°å­—
 * @param {boolean} isCorrect - æ­£è§£ã‹ã©ã†ã‹
 */
function addToHistory(num, isCorrect) {
    const span = document.createElement("span");
    span.textContent = num;
    span.className = "history-number";
    span.classList.add(isCorrect ? "correct" : "incorrect");
    historyContainer.appendChild(span);
    // è‡ªå‹•ã§ä¸€ç•ªä¸‹ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    historyContainer.scrollTop = historyContainer.scrollHeight;
}
</script>
</body>
</html>
