<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¹è‰¯ç‰ˆï¼é›»å“å‹è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-container {
            background: #2c3e50;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            text-align: center;
            width: 380px; /* æ¨ªå¹…ã‚’å°‘ã—åºƒã’ã‚‹ */
        }

        .calculator {
            background: #34495e;
            border-radius: 15px;
            padding: 20px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.2);
        }

        .display {
            background: #1a252f;
            color: #00ff41;
            font-size: 24px;
            font-weight: bold;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid #34495e;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            width: 100%; /* å¹…ã‚’è‡ªå‹•èª¿æ•´ */
            height: 60px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            user-select: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.number { background: #3498db; color: white; }
        .btn.operator { background: #e74c3c; color: white; }
        .btn.equals { background: #27ae60; color: white; grid-row: span 2; } /* ä¿®æ­£ */
        .btn.clear { background: #f39c12; color: white; }
        .btn.zero { grid-column: span 2; } /* 0ãƒœã‚¿ãƒ³ç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ  */

        .btn.active {
            background: #fff !important;
            color: #333 !important;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255,255,255,0.8);
        }

        .btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            display: flex;
            gap: 15px; /* é–“éš”ã‚’åºƒã’ã‚‹ */
            justify-content: center;
            align-items: center; /* ä¸­å¤®æƒãˆ */
            margin-top: 20px;
            flex-wrap: wrap; /* æŠ˜ã‚Šè¿”ã— */
        }

        .control-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #8e44ad;
            transform: translateY(-1px);
        }

        .control-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        /* --- ã“ã“ã‹ã‚‰è¿½åŠ ãƒ»å¤‰æ›´ã—ãŸã‚¹ã‚¿ã‚¤ãƒ« --- */
        .difficulty-selector {
            display: flex;
            gap: 10px;
            background: #34495e;
            padding: 5px;
            border-radius: 8px;
        }

        .difficulty-selector label {
            padding: 8px 12px;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .difficulty-selector input {
            display: none;
        }
        
        .difficulty-selector input:checked + label {
            background-color: #3498db;
            font-weight: bold;
        }

        .game-info {
            display: flex; /* Flexboxã«å¤‰æ›´ */
            justify-content: space-around; /* å‡ç­‰é…ç½® */
            align-items: center;
            color: white;
            margin-bottom: 20px;
        }
        
        .score-box {
            text-align: center;
        }
        /* --- ã“ã“ã¾ã§è¿½åŠ ãƒ»å¤‰æ›´ã—ãŸã‚¹ã‚¿ã‚¤ãƒ« --- */

        .score { font-size: 20px; font-weight: bold; color: #f1c40f; }
        .level { font-size: 16px; color: #ecf0f1; margin-top: 5px; }
        .status { font-size: 14px; color: #bdc3c7; margin-top: 10px; }
        .title { color: white; font-size: 24px; font-weight: bold; margin-bottom: 20px; }
        .instructions { color: #ecf0f1; font-size: 14px; margin-bottom: 20px; line-height: 1.4; }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .btn.flash { animation: flash 0.5s ease-in-out; }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="title">æ”¹è‰¯ç‰ˆï¼é›»å“å‹è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ  ğŸ§ </div>
        <div class="instructions">
            å…‰ã‚‹é †ç•ªã‚’è¦šãˆã¦ã€åŒã˜é †ç•ªã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼
        </div>
        
        <div class="game-info">
            <div class="score-box">
                <div class="score">ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="highScore">0</span></div>
                <div class="level"></div>
            </div>
            <div class="score-box">
                <div class="score">ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
                <div class="level">ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></div>
            </div>
        </div>
        <div class="status" id="status">é›£æ˜“åº¦ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼</div>
        <div class="calculator">
            <div class="display" id="display">è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ </div>
            
            <div class="buttons">
                <button class="btn clear" data-key="C">C</button>
                <button class="btn operator" data-key="/">/</button>
                <button class="btn operator" data-key="*">Ã—</button>
                <button class="btn operator" data-key="-">-</button>
                
                <button class="btn number" data-key="7">7</button>
                <button class="btn number" data-key="8">8</button>
                <button class="btn number" data-key="9">9</button>
                <button class="btn operator" data-key="+">+</button>
                
                <button class="btn number" data-key="4">4</button>
                <button class="btn number" data-key="5">5</button>
                <button class="btn number" data-key="6">6</button>
                <button class="btn equals" data-key="=">=</button>
                
                <button class="btn number" data-key="1">1</button>
                <button class="btn number" data-key="2">2</button>
                <button class="btn number" data-key="3">3</button>
                
                <button class="btn number zero" data-key="0">0</button>
                <button class="btn operator" data-key=".">.</button>
            </div>
            </div>

        <div class="controls">
            <div class="difficulty-selector" id="difficultySelector">
                <input type="radio" id="easy" name="difficulty" value="800" checked><label for="easy">ã‹ã‚“ãŸã‚“</label>
                <input type="radio" id="normal" name="difficulty" value="600"><label for="normal">ãµã¤ã†</label>
                <input type="radio" id="hard" name="difficulty" value="400"><label for="hard">ã‚€ãšã‹ã—ã„</label>
            </div>
            <button class="control-btn" id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button class="control-btn" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        </div>

    <script>
        class CalculatorMemoryGame {
            constructor() {
                // â–¼â–¼â–¼ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ  â–¼â–¼â–¼
                this.highScore = 0;
                this.sequenceSpeed = 600; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€Ÿåº¦
                this.sounds = {}; // ã‚µã‚¦ãƒ³ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ ¼ç´
                // â–²â–²â–² ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ  â–²â–²â–²

                this.sequence = [];
                this.playerInput = [];
                this.score = 0;
                this.level = 1;
                this.isPlaying = false;
                this.isShowingSequence = false;
                
                this.initializeGame();
                this.bindEvents();
                this.loadHighScore(); // ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’èª­ã¿è¾¼ã‚€
                this.preloadSounds(); // ã‚µã‚¦ãƒ³ãƒ‰ã‚’äº‹å‰ã«èª­ã¿è¾¼ã‚€
            }

            initializeGame() {
                this.display = document.getElementById('display');
                this.scoreElement = document.getElementById('score');
                this.levelElement = document.getElementById('level');
                this.statusElement = document.getElementById('status');
                this.startBtn = document.getElementById('startBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.gameButtons = document.querySelectorAll('.btn');

                // â–¼â–¼â–¼ æ–°ã—ã„è¦ç´ ã‚’å–å¾— â–¼â–¼â–¼
                this.highScoreElement = document.getElementById('highScore');
                this.difficultySelector = document.getElementById('difficultySelector');
                // â–²â–²â–² æ–°ã—ã„è¦ç´ ã‚’å–å¾— â–²â–²â–²
                
                this.updateDisplay();
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.startGame());
                this.resetBtn.addEventListener('click', () => this.resetGame());
                
                this.gameButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!this.isPlaying || this.isShowingSequence) return;
                        
                        const key = e.target.dataset.key;
                        if (key) {
                            this.handlePlayerInput(key);
                        }
                    });
                });

                // â–¼â–¼â–¼ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ  â–¼â–¼â–¼
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
                // â–²â–²â–² ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ  â–²â–²â–²
            }

            // â–¼â–¼â–¼ ã‚µã‚¦ãƒ³ãƒ‰èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã‚’è¿½åŠ  â–¼â–¼â–¼
            preloadSounds() {
                // Web Audio APIã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãªã—ã§ã‚‚å†ç”Ÿã§ãã‚‹ã‚ˆã†ã«æº–å‚™
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.audioCtx = new AudioContext();

                // åŠ¹æœéŸ³ã®ãƒ‡ãƒ¼ã‚¿ (Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰)
                // å®Ÿéš›ã«ã¯å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€æ–¹ãŒè‰¯ã„ã§ã™ãŒã€ã“ã“ã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ã¾ã¨ã‚ã¾ã™
                const soundData = {
                    click: 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA',
                    correct: 'data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhUQAAAP2/AP/9/wIA/f8EABAA/v8IABAD/v8KABAA/v4NABAA//kRABAD//kUABAA/v+BAAUA/v+HADwA//4kAHEAG/8vAHwAO/+BAB4AFv+MAHwAHf+aAIAAJv+oAIQAAP+zAIwAAACDAJAAAgCLAJQAJgCiAJgAGgDIAKEADgEQALoA+gCeAMEA+wClAOMABAClAQIAFgDLAQYAFgDkAQgAEgD5AQkADAD+AQgA',
                    wrong: 'data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhWAAAAAEAAgADAAQABQAGAAcACAAJAAoACwAMAA0ADgAPABAAEQASABMAFAAVABYAFwAYABkAGgAbABwAHQAeAB8AIAAhACIAIwAkACUAJgAnACgAKQAqACsALAAtAC4ALwAwADEAMgAzADQANQA2ADcAOAA5ADoAOwA8AD0APgA/AEAAQQBCAEMARABFAEYARwBIAEkASgBLAEwATQBOAE8AUABRAFIAUwBUAFUAVgBXAFgAWQBaAFsAXABdAF4AXwBgAGEAYgBjAGQAZQNm'
                };

                for (const key in soundData) {
                    this.sounds[key] = new Audio(soundData[key]);
                }
            }

            playSound(soundName) {
                if (this.sounds[soundName]) {
                    // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒä¸€æ™‚åœæ­¢çŠ¶æ…‹ãªã‚‰å†é–‹ (ãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•å†ç”Ÿãƒãƒªã‚·ãƒ¼å¯¾ç­–)
                    if (this.audioCtx.state === 'suspended') {
                        this.audioCtx.resume();
                    }
                    this.sounds[soundName].currentTime = 0;
                    this.sounds[soundName].play();
                }
            }
            // â–²â–²â–² ã‚µã‚¦ãƒ³ãƒ‰èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã‚’è¿½åŠ  â–²â–²â–²

            // â–¼â–¼â–¼ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå‡¦ç†ã‚’è¿½åŠ  â–¼â–¼â–¼
            handleKeyPress(e) {
                if (this.isPlaying && !this.isShowingSequence) {
                    const keyMap = {
                        'Enter': '=', 'Escape': 'C',
                        'NumpadEnter': '=', 'NumpadDecimal': '.', 'Decimal': '.',
                        'NumpadAdd': '+', 'NumpadSubtract': '-', 'NumpadMultiply': '*', 'NumpadDivide': '/'
                    };
                    
                    let key = e.key;
                    if (keyMap[e.code]) {
                        key = keyMap[e.code];
                    }

                    const button = document.querySelector(`.btn[data-key="${key}"]`);
                    if (button) {
                        e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        button.click();
                        
                        // ã‚¯ãƒªãƒƒã‚¯ã—ãŸè¦‹ãŸç›®ã‚’å†ç¾
                        button.classList.add('active');
                        setTimeout(() => button.classList.remove('active'), 100);
                    }
                }
            }
            // â–²â–²â–² ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå‡¦ç†ã‚’è¿½åŠ  â–²â–²â–²

            startGame() {
                this.isPlaying = true;
                this.sequence = [];
                this.playerInput = [];
                this.score = 0;
                this.level = 1;

                // â–¼â–¼â–¼ é›£æ˜“åº¦ã«å¿œã˜ãŸé€Ÿåº¦ã‚’è¨­å®š â–¼â–¼â–¼
                const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked').value;
                this.sequenceSpeed = parseInt(selectedDifficulty, 10);
                this.difficultySelector.style.pointerEvents = 'none'; // ã‚²ãƒ¼ãƒ ä¸­ã¯é›£æ˜“åº¦å¤‰æ›´ä¸å¯
                // â–²â–²â–² é›£æ˜“åº¦ã«å¿œã˜ãŸé€Ÿåº¦ã‚’è¨­å®š â–²â–²â–²
                
                this.startBtn.disabled = true;
                this.updateDisplay();
                this.updateStatus('ã‚²ãƒ¼ãƒ é–‹å§‹ï¼');
                
                setTimeout(() => {
                    this.nextLevel();
                }, 1000);
            }

            resetGame() {
                this.isPlaying = false;
                this.isShowingSequence = false;
                this.sequence = [];
                this.playerInput = [];
                this.score = 0;
                this.level = 1;
                
                this.startBtn.disabled = false;
                this.difficultySelector.style.pointerEvents = 'auto'; // é›£æ˜“åº¦å¤‰æ›´ã‚’å†åº¦å¯èƒ½ã«
                this.gameButtons.forEach(btn => {
                    btn.classList.remove('disabled', 'active');
                });
                
                this.updateDisplay();
                this.updateStatus('é›£æ˜“åº¦ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼');
                this.display.textContent = 'è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ ';
            }

            nextLevel() {
                this.playerInput = [];
                this.addToSequence();
                this.showSequence();
            }

            addToSequence() {
                const keys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 
                             '+', '-', '*', '/', '=', 'C', '.'];
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                this.sequence.push(randomKey);
            }

            async showSequence() {
                this.isShowingSequence = true;
                this.updateStatus('é †ç•ªã‚’è¦šãˆã¦ãã ã•ã„...');
                this.display.textContent = `ãƒ¬ãƒ™ãƒ« ${this.level}`;
                this.gameButtons.forEach(btn => btn.classList.add('disabled'));

                await this.wait(1000);

                for (let i = 0; i < this.sequence.length; i++) {
                    const key = this.sequence[i];
                    const button = document.querySelector(`[data-key="${key}"]`);
                    
                    if (button) {
                        button.classList.add('active');
                        this.display.textContent = key;
                        await this.wait(this.sequenceSpeed); // é›£æ˜“åº¦ã«å¿œã˜ãŸé€Ÿåº¦
                        
                        button.classList.remove('active');
                        this.display.textContent = '...';
                        await this.wait(this.sequenceSpeed / 2); // é–“ã®æ™‚é–“ã‚‚èª¿æ•´
                    }
                }
                
                this.isShowingSequence = false;
                this.gameButtons.forEach(btn => btn.classList.remove('disabled'));
                this.updateStatus('é †ç•ªé€šã‚Šã«ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
                this.display.textContent = 'ã‚ãªãŸã®ç•ªã§ã™';
            }

            handlePlayerInput(key) {
                this.playSound('click'); // ã‚¯ãƒªãƒƒã‚¯éŸ³ã‚’å†ç”Ÿ
                this.playerInput.push(key);
                this.display.textContent = this.playerInput.join(' ');
                
                const currentIndex = this.playerInput.length - 1;
                if (this.playerInput[currentIndex] !== this.sequence[currentIndex]) {
                    this.gameOver();
                    return;
                }

                if (this.playerInput.length === this.sequence.length) {
                    this.levelComplete();
                }
            }

            levelComplete() {
                this.playSound('correct'); // æ­£è§£éŸ³ã‚’å†ç”Ÿ
                this.score += this.level * 10;
                this.level++;
                this.updateDisplay();
                this.updateStatus('æ­£è§£ï¼æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸ï¼');
                
                setTimeout(() => {
                    this.nextLevel();
                }, 1500);
            }

            gameOver() {
                this.playSound('wrong'); // ä¸æ­£è§£éŸ³ã‚’å†ç”Ÿ
                this.isPlaying = false;
                this.startBtn.disabled = false;
                this.difficultySelector.style.pointerEvents = 'auto'; // é›£æ˜“åº¦å¤‰æ›´ã‚’å†åº¦å¯èƒ½ã«
                this.display.textContent = 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼';
                this.updateStatus(`ã‚²ãƒ¼ãƒ çµ‚äº†ï¼æœ€çµ‚ã‚¹ã‚³ã‚¢: ${this.score}`);
                
                // â–¼â–¼â–¼ ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°å‡¦ç†ã‚’è¿½åŠ  â–¼â–¼â–¼
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    this.saveHighScore();
                    this.updateStatus(`ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ ${this.highScore}`);
                }
                // â–²â–²â–² ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°å‡¦ç†ã‚’è¿½åŠ  â–²â–²â–²

                const wrongKey = this.playerInput[this.playerInput.length - 1];
                const wrongButton = document.querySelector(`[data-key="${wrongKey}"]`);
                if (wrongButton) {
                    wrongButton.style.background = '#e74c3c';
                    wrongButton.classList.add('flash');
                    setTimeout(() => {
                        wrongButton.style.background = '';
                        wrongButton.classList.remove('flash');
                    }, 1000);
                }
            }
            
            // â–¼â–¼â–¼ ãƒã‚¤ã‚¹ã‚³ã‚¢é–¢é€£ã®é–¢æ•°ã‚’è¿½åŠ  â–¼â–¼â–¼
            loadHighScore() {
                const storedHighScore = localStorage.getItem('calculatorMemoryHighScore');
                if (storedHighScore) {
                    this.highScore = parseInt(storedHighScore, 10);
                }
                this.highScoreElement.textContent = this.highScore;
            }

            saveHighScore() {
                localStorage.setItem('calculatorMemoryHighScore', this.highScore);
                this.highScoreElement.textContent = this.highScore;
            }
            // â–²â–²â–² ãƒã‚¤ã‚¹ã‚³ã‚¢é–¢é€£ã®é–¢æ•°ã‚’è¿½åŠ  â–²â–²â–²

            updateDisplay() {
                this.scoreElement.textContent = this.score;
                this.levelElement.textContent = this.level;
                this.highScoreElement.textContent = this.highScore; // ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚‚æ›´æ–°
            }

            updateStatus(message) {
                this.statusElement.textContent = message;
            }

            wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new CalculatorMemoryGame();
        });
    </script>
</body>
</html>
