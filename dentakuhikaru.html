<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¹è‰¯ç‰ˆï¼é›»å“å‹è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ </title>
    <style>
        /* Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Electrolize&display=swap');

        /* ğŸ”½ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ã™ã‚‹ãŸã‚ã®ä¿®æ­£ ğŸ”½ */
        html, body {
            height: 100%; /* HTMLã¨Bodyã®é«˜ã•ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã«åˆã‚ã›ã‚‹ */
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ */
        }
        /* ğŸ”¼ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ã™ã‚‹ãŸã‚ã®ä¿®æ­£ ğŸ”¼ */

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a0a2a 0%, #0a0a1a 100%);
            margin: 0;
            padding: 10px; 
            display: flex;
            justify-content: center;
            align-items: center;
            /* height: 100vh; ã®ä»£ã‚ã‚Šã« height: 100% ã‚’ä½¿ç”¨ã—ã€html, body ã®è¨­å®šã‚’æ´»ã‹ã™ */
            min-height: 100%; 
            box-sizing: border-box; 
        }

        .game-container {
            background: #0d0d1a;
            padding: 15px; 
            border-radius: 15px; 
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.4);
            text-align: center;
            width: 95%; 
            max-width: 400px; 
            border: 2px solid #4ecdc4;
            box-sizing: border-box;
            /* ğŸ”½ ç”»é¢ã«åã¾ã‚‰ãªã„å ´åˆã«å‚™ãˆã¦ã€ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æœ€å¤§é«˜ã•ã‚’è¨­å®š ğŸ”½ */
            max-height: 100%; 
            overflow-y: auto; /* ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ãŒç”»é¢ã‚ˆã‚Šå¤§ãã„å ´åˆã¯å†…éƒ¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ (ä»Šå›ã¯å…¨ä½“ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ã—ã¦ã„ã‚‹ã®ã§ã€ä¸»ã«Android Chromeã®UIéš ã‚Œå¯¾ç­–) */
            /* ğŸ”¼ ç”»é¢ã«åã¾ã‚‰ãªã„å ´åˆã«å‚™ãˆã¦ã€ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®æœ€å¤§é«˜ã•ã‚’è¨­å®š ğŸ”¼ */
        }

        .title { 
            color: white; 
            font-size: 24px; 
            margin-bottom: 10px; 
            text-shadow: 0 0 10px #00f0ff, 0 0 20px #ff00ff;
            font-family: 'Electrolize', sans-serif;
        }

        .instructions { 
            color: #b2fefd; 
            font-size: 12px; 
            margin-bottom: 10px; 
            line-height: 1.3;
            text-shadow: 0 0 3px rgba(178, 254, 253, 0.5);
        }

        .game-info {
            color: #4ecdc4;
            margin-bottom: 15px; 
            padding-bottom: 8px; 
            font-size: 14px; 
        }
        
        .score { font-size: 18px; }
        .level { font-size: 13px; }

        .status { 
            font-size: 14px; 
            margin-top: 5px; 
            margin-bottom: 15px;
        }

        .calculator {
            background: #1a0a2a;
            border-radius: 10px; 
            padding: 15px; 
            box-shadow: inset 0 0 10px rgba(255, 0, 255, 0.3);
            border: 1px solid #ff00ff;
        }

        .display {
            background: #05050f;
            color: #00ff00;
            font-size: 24px; 
            padding: 15px; 
            margin-bottom: 15px; 
            min-height: 40px; 
            font-weight: bold;
            border-radius: 10px;
            border: 2px solid #00ff00;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Share Tech Mono', monospace;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.6);
        }

        .buttons {
            display: grid; 
            grid-template-columns: repeat(4, 1fr);
            gap: 8px; 
            margin-bottom: 15px; 
        }

        .btn {
            width: 100%;
            height: 50px; 
            border: none;
            border-radius: 8px; 
            font-size: 18px; 
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
            user-select: none;
            color: white;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 12px rgba(0,0,0,0.6); }
        .btn:active { transform: translateY(0); box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .btn.number { background: #007bff; border: 1px solid #00f0ff; box-shadow: 0 0 8px rgba(0, 240, 255, 0.6); }
        .btn.operator { background: #ff007f; border: 1px solid #ff00ff; box-shadow: 0 0 8px rgba(255, 0, 255, 0.6); }
        .btn.equals { background: #00cc66; border: 1px solid #00ff00; grid-row: span 2; box-shadow: 0 0 8px rgba(0, 255, 0, 0.6); }
        .btn.clear { background: #ffaa00; border: 1px solid #ffcc00; box-shadow: 0 0 8px rgba(255, 204, 0, 0.6); }
        .btn.zero { grid-column: span 2; }
        .btn.active { background: #fff !important; color: #000 !important; transform: scale(1.1); box-shadow: 0 0 20px rgba(255,255,255,0.9); border-color: #fff !important; }
        .btn.disabled { opacity: 0.3; cursor: not-allowed; box-shadow: none; }
        
        .controls { 
            display: flex; 
            gap: 10px; 
            justify-content: center; 
            align-items: center; 
            margin-top: 15px; 
            flex-wrap: wrap; 
        }

        .control-btn { 
            background: #8e2de2; 
            color: white; 
            border: 2px solid #ff00ff; 
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: bold; 
            transition: all 0.2s; 
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.4); 
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); 
        }
        .control-btn:hover { background: #6a1a9e; transform: translateY(-1px); box-shadow: 0 0 12px rgba(255, 0, 255, 0.7); }
        .control-btn:disabled { background: #333; border-color: #555; cursor: not-allowed; transform: none; box-shadow: none; color: #999; }
        
        .difficulty-selector { display: flex; gap: 5px; background: #1a0a2a; padding: 3px; border-radius: 8px; border: 1px solid #4ecdc4; }
        .difficulty-selector label { padding: 6px 10px; color: #4ecdc4; border-radius: 6px; cursor: pointer; transition: background-color 0.2s, color 0.2s, box-shadow 0.2s; text-shadow: 0 0 5px rgba(78, 205, 196, 0.5); font-size: 13px; }
        .difficulty-selector input { display: none; }
        .difficulty-selector input:checked + label { background-color: #4ecdc4; color: #000; font-weight: bold; box-shadow: 0 0 8px rgba(78, 205, 196, 0.8); text-shadow: none; }
        
        .game-info { display: flex; justify-content: space-around; align-items: center; border-bottom: 1px dashed #ff00ff; }
        .score-box { text-align: center; }
        .score { color: #ffeb3b; text-shadow: 0 0 8px rgba(255, 235, 59, 0.8); }
        .level { color: #b2fefd; margin-top: 3px; }
        .status { color: #ff00ff; text-shadow: 0 0 5px rgba(255, 0, 255, 0.6); }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.1; }
        }
        .btn.flash { 
            animation: flash 0.5s ease-in-out; 
            box-shadow: 0 0 20px #ff0000; 
            border-color: #ff0000 !important;
        }

        /* ğŸ“± ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç¸¦ç”»é¢å‘ã‘èª¿æ•´ (å‰å›ã®æœ€é©åŒ–ã‚’ç¶­æŒ) */
        @media (max-width: 450px) {
            body { padding: 5px; }
            .game-container { padding: 10px; border-radius: 10px; }
            .calculator { padding: 10px; }
            .display { font-size: 20px; padding: 10px; min-height: 35px; margin-bottom: 10px; }
            .title { font-size: 22px; margin-bottom: 8px; }
            .instructions { font-size: 11px; margin-bottom: 8px; }
            .buttons { gap: 6px; margin-bottom: 10px; }
            .btn { height: 45px; font-size: 16px; border-radius: 6px; }
            .controls { margin-top: 10px; gap: 8px; }
            .control-btn { padding: 8px 15px; font-size: 13px; }
            .difficulty-selector label { padding: 5px 8px; font-size: 12px; }
            .game-info { margin-bottom: 10px; }
            .score { font-size: 16px; }
        }
        /* ğŸ“± é«˜ã•ã®èª¿æ•´ (ç‰¹ã«çŸ­ã„ç”»é¢å‘ã‘) */
        @media (max-height: 700px) and (max-width: 450px) {
            .btn { height: 40px; font-size: 15px; }
            .calculator { padding: 8px; }
            .buttons { gap: 5px; }
            .display { padding: 8px; font-size: 18px; min-height: 30px; }
        }

    </style>
</head>
<body>
    <div class="game-container">
        <div class="title">æ”¹è‰¯ç‰ˆï¼é›»å“å‹è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ  ğŸ§ </div>
        <div class="instructions">
            å…‰ã‚‹é †ç•ªã‚’è¦šãˆã¦ã€åŒã˜é †ç•ªã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼
        </div>
        
        <div class="game-info">
            <div class="score-box">
                <div class="score">ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="highScore">0</span></div>
                <div class="level"></div>
            </div>
            <div class="score-box">
                <div class="score">ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
                <div class="level">ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></div>
            </div>
        </div>
        <div class="status" id="status">é›£æ˜“åº¦ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼</div>
        <div class="calculator">
            <div class="display" id="display">è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ </div>
            
            <div class="buttons">
                <button class="btn clear" data-key="C">C</button>
                <button class="btn operator" data-key="/">/</button>
                <button class="btn operator" data-key="*">Ã—</button>
                <button class="btn operator" data-key="-">-</button>
                
                <button class="btn number" data-key="7">7</button>
                <button class="btn number" data-key="8">8</button>
                <button class="btn number" data-key="9">9</button>
                <button class="btn operator" data-key="+">+</button>
                
                <button class="btn number" data-key="4">4</button>
                <button class="btn number" data-key="5">5</button>
                <button class="btn number" data-key="6">6</button>
                <button class="btn equals" data-key="=">=</button>
                
                <button class="btn number" data-key="1">1</button>
                <button class="btn number" data-key="2">2</button>
                <button class="btn number" data-key="3">3</button>
                
                <button class="btn number zero" data-key="0">0</button>
                <button class="btn operator" data-key=".">.</button>
            </div>
            </div>

        <div class="controls">
            <div class="difficulty-selector" id="difficultySelector">
                <input type="radio" id="easy" name="difficulty" value="800" checked><label for="easy">ã‹ã‚“ãŸã‚“</label>
                <input type="radio" id="normal" name="difficulty" value="600"><label for="normal">ãµã¤ã†</label>
                <input type="radio" id="hard" name="difficulty" value="400"><label for="hard">ã‚€ãšã‹ã—ã„</label>
            </div>
            <button class="control-btn" id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button class="control-btn" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        </div>

    <script>
        class CalculatorMemoryGame {
            constructor() {
                this.highScore = 0;
                this.sequenceSpeed = 600; 
                this.sounds = {}; 

                this.sequence = [];
                this.playerInput = [];
                this.score = 0;
                this.level = 1;
                this.isPlaying = false;
                this.isShowingSequence = false;
                
                this.initializeGame();
                this.bindEvents();
                this.loadHighScore(); 
                this.preloadSounds(); 
            }

            initializeGame() {
                this.display = document.getElementById('display');
                this.scoreElement = document.getElementById('score');
                this.levelElement = document.getElementById('level');
                this.statusElement = document.getElementById('status');
                this.startBtn = document.getElementById('startBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.gameButtons = document.querySelectorAll('.btn');
                this.highScoreElement = document.getElementById('highScore');
                this.difficultySelector = document.getElementById('difficultySelector');
                
                this.updateDisplay();
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.startGame());
                this.resetBtn.addEventListener('click', () => this.resetGame());
                
                this.gameButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!this.isPlaying || this.isShowingSequence) return;
                        
                        const key = e.target.dataset.key;
                        if (key) {
                            this.handlePlayerInput(key);
                        }
                    });
                });
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
            }

            preloadSounds() {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.audioCtx = new AudioContext();

                const soundData = {
                    click: 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA',
                    correct: 'data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhUQAAAP2/AP/9/wIA/f8EABAA/v8IABAD/v8KABAA/v4NABAA//kRABAD//kUABAA/v+BAAUA/v+HADwA//4kAHEAG/8vAHwAO/+BAB4AFv+MAHwAHf+aAIAAJv+oAIQAAP+zAIwAAACDAJAAAgCLAJQAJgCiAJgAGgDIAKEADgEQALoA+gCeAMEA+wClAOMABAClAQIAFgDLAQYAFgDkAQgAEgD5AQkADAD+AQgA',
                    wrong: 'data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhWAAAAAEAAgADAAQABQAGAAcACAAJAAoACwAMAA0ADgAPABAAEQASABMAFAAVABYAFwAYABkAGgAbABwAHQAeAB8AIAAhACIAIwAkACUAJgAnACgAKQAqACsALAAtAC4ALwAwADEAMgAzADQANQA2ADcAOAA5ADoAOwA8AD0APgA/AEAAQQBCAEMARABFAEYARwBIAEkASgBLAEwATQBOAE8AUABRAFIAUwBUAFUAVgBXAFgAWQBaAFsAXABdAF4AXwBgAGEAYgBjAGQAZQNm'
                };

                for (const key in soundData) {
                    this.sounds[key] = new Audio(soundData[key]);
                }
            }

            playSound(soundName) {
                if (this.sounds[soundName]) {
                    if (this.audioCtx.state === 'suspended') {
                        this.audioCtx.resume();
                    }
                    this.sounds[soundName].currentTime = 0;
                    this.sounds[soundName].play();
                }
            }

            handleKeyPress(e) {
                if (this.isPlaying && !this.isShowingSequence) {
                    const keyMap = {
                        'Enter': '=', 'Escape': 'C',
                        'NumpadEnter': '=', 'NumpadDecimal': '.', 'Decimal': '.',
                        'NumpadAdd': '+', 'NumpadSubtract': '-', 'NumpadMultiply': '*', 'NumpadDivide': '/'
                    };
                    
                    let key = e.key;
                    if (keyMap[e.code]) {
                        key = keyMap[e.code];
                    } else if (e.key >= '0' && e.key <= '9') {
                        key = e.key;
                    }

                    const button = document.querySelector(`.btn[data-key="${key}"]`);
                    if (button) {
                        e.preventDefault(); 
                        button.click();
                        
                        button.classList.add('active');
                        setTimeout(() => button.classList.remove('active'), 100);
                    }
                }
            }

            startGame() {
                this.isPlaying = true;
                this.sequence = [];
                this.playerInput = [];
                this.score = 0;
                this.level = 1;

                const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked').value;
                this.sequenceSpeed = parseInt(selectedDifficulty, 10);
                this.difficultySelector.style.pointerEvents = 'none'; 
                
                this.startBtn.disabled = true;
                this.updateDisplay();
                this.updateStatus('ã‚²ãƒ¼ãƒ é–‹å§‹ï¼');
                
                setTimeout(() => {
                    this.nextLevel();
                }, 1000);
            }

            resetGame() {
                this.isPlaying = false;
                this.isShowingSequence = false;
                this.sequence = [];
                this.playerInput = [];
                this.score = 0;
                this.level = 1;
                
                this.startBtn.disabled = false;
                this.difficultySelector.style.pointerEvents = 'auto';
                this.gameButtons.forEach(btn => {
                    btn.classList.remove('disabled', 'active', 'flash');
                    btn.style.background = '';
                });
                
                this.updateDisplay();
                this.updateStatus('é›£æ˜“åº¦ã‚’é¸ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼');
                this.display.textContent = 'è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ ';
            }

            nextLevel() {
                this.playerInput = [];
                this.addToSequence();
                this.showSequence();
            }

            addToSequence() {
                const keys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 
                             '+', '-', '*', '/', '=', 'C', '.'];
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                this.sequence.push(randomKey);
            }

            async showSequence() {
                this.isShowingSequence = true;
                this.updateStatus('é †ç•ªã‚’è¦šãˆã¦ãã ã•ã„...');
                this.display.textContent = `ãƒ¬ãƒ™ãƒ« ${this.level}`;
                this.gameButtons.forEach(btn => btn.classList.add('disabled'));

                await this.wait(1000);

                for (let i = 0; i < this.sequence.length; i++) {
                    const key = this.sequence[i];
                    const button = document.querySelector(`[data-key="${key}"]`);
                    
                    if (button) {
                        this.playSound('click'); 
                        button.classList.add('active');
                        this.display.textContent = key;
                        await this.wait(this.sequenceSpeed);
                        
                        button.classList.remove('active');
                        this.display.textContent = '...';
                        await this.wait(this.sequenceSpeed / 2);
                    }
                }
                
                this.isShowingSequence = false;
                this.gameButtons.forEach(btn => btn.classList.remove('disabled'));
                this.updateStatus('é †ç•ªé€šã‚Šã«ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
                this.display.textContent = 'ã‚ãªãŸã®ç•ªã§ã™';
            }

            handlePlayerInput(key) {
                this.playSound('click'); 
                this.playerInput.push(key);
                this.display.textContent = this.playerInput.join(' ');
                
                const currentIndex = this.playerInput.length - 1;
                if (this.playerInput[currentIndex] !== this.sequence[currentIndex]) {
                    this.gameOver();
                    return;
                }

                if (this.playerInput.length === this.sequence.length) {
                    this.levelComplete();
                }
            }

            levelComplete() {
                this.playSound('correct'); 
                this.score += this.level * 10;
                this.level++;
                this.updateDisplay();
                this.updateStatus('æ­£è§£ï¼æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸ï¼');
                
                setTimeout(() => {
                    this.nextLevel();
                }, 1500);
            }

            gameOver() {
                this.playSound('wrong'); 
                this.isPlaying = false;
                this.startBtn.disabled = false;
                this.difficultySelector.style.pointerEvents = 'auto';
                this.display.textContent = 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼';
                this.updateStatus(`ã‚²ãƒ¼ãƒ çµ‚äº†ï¼æœ€çµ‚ã‚¹ã‚³ã‚¢: ${this.score}`);
                
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    this.saveHighScore();
                    this.updateStatus(`ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ ${this.highScore}`);
                }

                const wrongKey = this.playerInput[this.playerInput.length - 1];
                const wrongButton = document.querySelector(`[data-key="${wrongKey}"]`);
                if (wrongButton) {
                    wrongButton.classList.add('flash'); 
                    setTimeout(() => {
                        wrongButton.classList.remove('flash');
                    }, 1000);
                }
            }
            
            loadHighScore() {
                const storedHighScore = localStorage.getItem('calculatorMemoryHighScore');
                if (storedHighScore) {
                    this.highScore = parseInt(storedHighScore, 10);
                }
                this.highScoreElement.textContent = this.highScore;
            }

            saveHighScore() {
                localStorage.setItem('calculatorMemoryHighScore', this.highScore);
                this.highScoreElement.textContent = this.highScore;
            }

            updateDisplay() {
                this.scoreElement.textContent = this.score;
                this.levelElement.textContent = this.level;
                this.highScoreElement.textContent = this.highScore; 
            }

            updateStatus(message) {
                this.statusElement.textContent = message;
            }

            wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new CalculatorMemoryGame();
        });
    </script>
</body>
</html>
