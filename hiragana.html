<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã²ã‚‰ãŒãª ã‚‚ã˜ãªã‚‰ã¹ã‹ãˆ è„³ãƒˆãƒ¬ DX (4æ–‡å­—ä»¥ä¸Šå¯¾å¿œ)</title>
<style>
  /* è‰²ã‚„åŸºæœ¬çš„ãªã‚¹ã‚¿ã‚¤ãƒ«ã¯ç¶­æŒã—ã¤ã¤ã€ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—é–¢é€£ã‚’è¿½åŠ  */
  :root{
    --bg:#f3f6fb;
    --card:#ffffff;
    --primary:#0b63b6;
    --accent:#06a88e;
    --muted:#5a6b78;
    --btn-bg:#ffffff;
    --btn-border:#dbeaf8;
    --char-bg:#fff9e6;
    --slot-bg:#e9f6ff;
    --correct:#1f8a4c;
    --wrong:#c73838;
    --drag-over-color: #6da2e0; /* DnDæ™‚ã®ç›®å°ã®è‰² */
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family: "Noto Sans JP","ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN","Hiragino Kaku Gothic ProN","Yu Gothic","Meiryo",system-ui,sans-serif;background:var(--bg);color:#052033;-webkit-font-smoothing:antialiased}
  .wrap{max-width:900px;margin:24px auto;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:20px;margin:0;color:var(--primary)}
  .controls{display:flex;gap:8px;align-items:center}
  .status{font-size:14px;color:var(--muted)}
  button{appearance:none;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;background:var(--primary);color:#fff;box-shadow:0 6px 18px rgba(11,99,182,0.12);transition:background 0.2s, opacity 0.2s}
  button:disabled{opacity:0.6; cursor: not-allowed; box-shadow:none} /* Disabledã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ  */
  button.secondary{background:var(--btn-bg);color:var(--primary);border:1px solid var(--btn-border);box-shadow:none}
  button.ghost{background:transparent;color:var(--primary);border:1px dashed rgba(11,99,182,0.12);padding:8px 12px}
  main{margin-top:16px}
  .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 12px 34px rgba(6,24,48,0.06)}
  .row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
  .panel{flex:1;min-width:260px}
  .hint{font-size:13px;color:var(--muted);margin-bottom:8px}
  .answer{min-height:64px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;padding:10px;border-radius:12px;background:linear-gradient(180deg,#fbfeff,#f7fbff);border:1px solid rgba(11,99,182,0.06)}
  
  /* Slotã®DnDå¯¾å¿œã‚¹ã‚¿ã‚¤ãƒ« */
  .slot{
    min-width:48px;border-radius:10px;padding:10px 12px;font-size:20px;background:var(--slot-bg);
    border:2px solid rgba(11,99,182,0.10);color:#022b45;cursor:grab;display:flex;align-items:center;
    justify-content:center; position: relative;
    /* DnDé–¢é€£ */
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .slot:active{ cursor: grabbing; box-shadow: 0 4px 10px rgba(11,99,182,0.2); transform: translateY(-2px)}
  .slot.dragging{ opacity: 0.5; }
  .slot.drag-over{ border: 2px solid var(--drag-over-color); }

  .scrambled{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;padding:10px;border-radius:12px;background:#ffffff;min-height:120px;align-items:flex-start}
  .char-btn{background:var(--char-bg);color:#07223a;border-radius:12px;padding:12px 14px;font-size:22px;cursor:pointer;border:2px solid rgba(2,34,53,0.04);min-width:56px;text-align:center;box-shadow:0 6px 18px rgba(4,28,48,0.04)}
  .char-btn.disabled{opacity:0.36;cursor:default;box-shadow:none}
  .controls-row{display:flex;gap:8px;align-items:center;margin-top:12px}
  .feedback{margin-top:12px;font-weight:800;font-size:16px;min-height:24px}
  .meta{display:flex;gap:12px;align-items:center;color:var(--muted);font-size:13px;margin-top:12px}
  .correct-badge{color:var(--correct)}
  .wrong-badge{color:var(--wrong)}
  footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
  
  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æ”¹å–„ */
  @media(max-width:640px){
    .char-btn{padding:10px 12px;font-size:20px;min-width:46px}
    .slot{min-width:44px;font-size:18px;padding:8px 10px}
    header{flex-direction:column;align-items:flex-start;gap:10px}
    .row{flex-direction: column;} /* ã‚¹ãƒãƒ›ã§ã¯ç¸¦ä¸¦ã³ */
    .panel{min-width: 100%;}
  }
</style>
</head>
<body>
<div class="wrap" role="main" aria-label="ã²ã‚‰ãŒãª æ–‡å­—ä¸¦ã¹æ›¿ãˆã‚²ãƒ¼ãƒ ">
  <header>
    <h1>ã²ã‚‰ãŒãª ã‚‚ã˜ãªã‚‰ã¹ã‹ãˆ è„³ãƒˆãƒ¬ DX</h1>
    <div class="controls" aria-hidden="false">
      <div class="status" id="status">ã‚‚ã‚“ã ã„: 0 / 300</div>
      <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button id="nextBtn" class="secondary">ã¤ãã¸</button>
    </div>
  </header>

  <main>
    <div class="card" role="region" aria-label="ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢">
      <div class="row">
        <div class="panel" style="flex:2">
          <div class="hint"><strong>ãƒ’ãƒ³ãƒˆ</strong>ï¼šã‚‚ã˜ã™ã†ã‚’ã¿ã¦ãã ã•ã„ (é¸æŠæ–‡å­—ã¯**ãƒ‰ãƒ©ãƒƒã‚°ã§ä¸¦ã¹æ›¿ãˆ**ã§ãã¾ã™)</div>
          <div><strong>ãˆã‚‰ã‚“ã ã‚‚ã˜ (ç­”ãˆã®é †ã«ä¸¦ã¹ã¦ã­)</strong></div>
          <div id="answerArea" class="answer" aria-live="polite" aria-label="ãˆã‚‰ã‚“ã æ–‡å­—"></div>

          <div class="controls-row">
            <button id="confirmBtn" disabled>ã‹ãã¦ã„</button>
            <button id="clearBtn" class="secondary">ãã‚Šã‚</button>
            <button id="shuffleBtn" class="secondary">ã•ã„ã—ã‚ƒãµã‚‹</button>
            <button id="revealBtn" class="ghost" title="ã›ã„ã‹ã„ã‚’ã¿ã›ã‚‹">ã“ãŸãˆ</button>
            <div style="flex:1"></div>
            <div class="status" id="timer">ã˜ã‹ã‚“: 00:00</div>
          </div>

          <div id="feedback" class="feedback" aria-live="polite"></div>

          <div class="meta" aria-hidden="false">
            <div>ã›ã„ã‹ã„ã™ã†: <span id="correctCount">0</span></div>
            <div>ã®ã“ã‚Š: <span id="remaining">300</span></div>
          </div>
        </div>

        <div class="panel" style="flex:1;min-width:240px">
          <div class="hint"><strong>ã°ã‚‰ã°ã‚‰ã®ã‚‚ã˜ (æ•°å­—ã‚­ãƒ¼ã§é¸æŠå¯èƒ½)</strong></div>
          <div id="scrambled" class="scrambled" role="list" aria-label="ã°ã‚‰ã°ã‚‰ã®ã‚‚ã˜"></div>

          <div style="margin-top:12px;color:var(--muted);font-size:13px">
            ãã†ã•ï¼šã‚‚ã˜ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãˆã‚‰ã³ã€ã‚¹ãƒ­ãƒƒãƒˆã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã‚‚ã©ã‚‹ã€‚ã‚¹ãƒãƒ›å¯¾å¿œã€‚
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>ãƒ’ãƒ³ãƒˆï¼šã‚ã‹ã‚‰ãªã„ã¨ãã¯ã€Œã“ãŸãˆã€ã‚’ãŠã—ã¦ã¿ã¦ãã ã•ã„</footer>
</div>

<script>
/* ===== ã²ã‚‰ãŒãªå˜èªãƒªã‚¹ãƒˆï¼ˆ4æ–‡å­—ä»¥ä¸Šã®å˜èªã«çµã‚Šè¾¼ã¿æ¸ˆã¿ï¼‰ ===== */
const ORIGINAL_WORDS = [
"ã‚ãŸã—","ã‚ãªãŸ","ã‹ã‚Œ","ã‹ã®ã˜ã‚‡","ã¨ã‚‚ã ã¡","ã„ãˆ","ãŒã£ã“ã†","ã›ã‚“ã›ã„","ã»ã‚“","ã¤ããˆ",
"ã—ã‚ƒã—ã‚“","ã—ã‚“ã¶ã‚“","ãã‚‹ã¾","ãˆã","ã¿ã›","ã‚Šã‚‡ã†ã‚Š","ã‚ã•ã”ã¯ã‚“","ã²ã‚‹ã”ã¯ã‚“","ã°ã‚“ã”ã¯ã‚“","ã˜ã‹ã‚“",
"ãã‚‡ã†","ã‚ã—ãŸ","ãã®ã†","ã—ã”ã¨","ã‹ã„ã—ã‚ƒ","ã§ã‚“ã—ã‚ƒ","ã§ã‚“ã‚","ã¦ãŒã¿","ã¸ã‚„","ã¾ã©",
"ã„ã™","ã­ã“","ã„ã¬","ã¨ã‚Š","ã•ã‹ãª","ã‚„ã¾","ã‹ã‚","ã†ã¿","ãã‚‰","ã‚ã‚",
"ã‚†ã","ã¯ã‚‹","ãªã¤","ã‚ã","ãµã‚†","ã¯ãª","ã","ã¯","ã¿ã¡","ã¯ã—",
"ã¦ã‚“ã„ã‚“","ãã‚ƒã","ã³ã‚‡ã†ã„ã‚“","ãã™ã‚Š","ã³ã‚‡ã†ã","ã’ã‚“ã","ãˆãŒãŠ","ã‚†ã‚","ãˆã„ãŒ","ãŠã‚“ãŒã",
"ã†ãŸ","ã‚Šã‚‡ã“ã†","ã²ã“ã†ã","ãã£ã·","ã¡ãš","ã“ã†ãˆã‚“","ã«ã‚","ã¨ã‘ã„","ã•ã„ãµ","ã‹ã",
"ã‹ã•","ã¼ã†ã—","ãã¤","ãã¤ã—ãŸ","ãµã","ã„ã‚","ã—ã‚","ãã‚","ã‚ã‹","ã‚ãŠ",
"ã¿ã©ã‚Š","ãã„ã‚","ã¡ã‚ƒã„ã‚","ãã‚“","ãã‚“","ã‹ã¿","ãµã†ã¨ã†","ãˆã‚“ã´ã¤","ã‘ã—ã”ã‚€","ãºã‚“",
"ã‘ã„ãŸã„","ãŒã‚ã‚“","ã—ã‚ƒã—ã‚“ã—ã‚…ã†","ã–ã£ã—","ã»ã‚“ã ãª","ã‚Šã‚‡ã†ã‚Šã«ã‚“","ã—ã‚‡ãã©ã†","ã¦ã‚“ã¡ã‚‡ã†","ã‚†ã†ã˜ã‚“","ã‹ãã",
"ã¡ã¡","ã¯ã¯","ã‚ã«","ã‚ã­","ãŠã¨ã†ã¨","ã„ã‚‚ã†ã¨","ã‚€ã™ã“","ã‚€ã™ã‚","ãŠã£ã¨","ã¤ã¾",
"ã‘ã£ã“ã‚“","ãŸã‚“ã˜ã‚‡ã†ã³","ãã­ã‚“ã³","ã¾ã¤ã‚Š","ã‹ã—ã‚…","ã¯ã„ã‚†ã†","ãˆã„ãŒã‹ã‚“","ã’ãã˜ã‚‡ã†","ãˆã‚“ãã†","ã¶ãŸã„",
"ãˆ","ã—ã‚ƒã—ã‚“ã‹","ãŒã‹","ãµã†ã‘ã„","ãŸã¦ã‚‚ã®","ãã‚‡ã†ã‚Šã‚‡ã†","ã©ã†ã‚","ã—ã‚“ã”ã†","ã“ã†ã•ã¦ã‚“","ã“ã†ãã",
"ã†ã‚“ã¦ã‚“","ã˜ã¦ã‚“ã—ã‚ƒ","ã»ã©ã†","ã¡ã‹ã¦ã¤","ãã†ã“ã†","ã—ã‚…ã£ã±ã¤","ã¨ã†ã¡ã‚ƒã","ã¾ã¡ã‚ã„ã—ã¤","ã—ã‚…ã†ã”ã†","ã‹ã„ã•ã‚“",
"ã‘ã„ã‹ã","ã‚ã‚“ãªã„","ã›ã¤ã‚ã„","ã—ã¤ã‚‚ã‚“","ã“ãŸãˆ","ã»ã‚“ã­","ã²ã¿ã¤","ã‚Šã‚†ã†","ã„ã‘ã‚“","ã‹ã‚“ãŒãˆ",
"ãã†ãã†","ããŠã","ã‚Œãã—","ã¿ã‚‰ã„","ã’ã‚“ã–ã„","ã‹ã“","ã¶ã‚“ã‹","ã§ã‚“ã¨ã†","ã“ã¨ã°","ã»ã†ã’ã‚“",
"ã‹ã‚“ã˜","ã‹ãª","ã‚ã‚‹ãµãã¹ã£ã¨","ã™ã†ã˜","ã‘ã„ã•ã‚“","ã‚‚ã‚“ã ã„","ã“ãŸãˆ","ã¹ã‚“ãã‚‡ã†","ã—ã‘ã‚“","ã”ã†ã‹ã",
"ãã¤ãã‚‡ã†","ã«ã‚…ã†ãŒã","ã©ã†ã","ãªã‹ã¾","ã›ã‚“ã›ã„ãŒãŸ","ã—ã©ã†","ã‚‚ãã²ã‚‡ã†","ã¡ã‚‡ã†ã›ã‚“","ã›ã„ã“ã†","ã—ã£ã±ã„",
"ã‹ã„ãœã‚“","ã›ã„ã¡ã‚‡ã†","ã¸ã‚“ã‹","ã—ã‚…ã†ã‹ã‚“","ã‘ã‚“ã“ã†","ã†ã‚“ã©ã†","ã•ã‚“ã½","ãŸã„ã˜ã‚…ã†","ã—ã‚‡ãã˜","ãˆã„ã‚ˆã†",
"ã™ã„ã¿ã‚“","ãã‚…ã†ã‘ã„","ã—ã‚…ã†ã¡ã‚…ã†","ã¡ã‚…ã†ã„","ã‚ã‚“ãœã‚“","ãã‘ã‚“","ã²","ã¿ãš","ã§ã‚“ã","ãŒã™",
"ãŠã‚“ã©","ã—ã¤ã©","ã¦ã‚“ã","ã‚ˆã»ã†","ã‘ã„ã»ã†","ã˜ã—ã‚“","ã¤ãªã¿","ã²ãªã‚“","ã˜ã‚…ã‚“ã³","ãŸã„ã•ã",
"ã»ã‘ã‚“","ã‘ã„ã‚„ã","ã‚Šã‚‡ã†ãã‚“","ã‚ã‚Šã³ã","ã‹ã‹ã","ã—ã¯ã‚‰ã„","ã’ã‚“ãã‚“","ã‹ãƒ¼ã©","ã‚Šã‚‡ã†ã—ã‚…ã†ã—ã‚‡","ã›ã„ãã‚…ã†",
"ãã‚“ã“ã†","ã“ã†ã–","ã¡ã‚‡ãã‚“","ã¨ã†ã—","ã‚Šãˆã","ãã‚“ã—ã¤","ã‘ã„ã‚„ãã—ã‚‡","ã—ã‚‡ã‚‹ã„","ã¦ã„ã—ã‚…ã¤","ã‹ãã«ã‚“",
"ãã†ã—ã‚“","ã˜ã‚…ã—ã‚“","ã¨ã†ã‚ã","ã‹ã„ã˜ã‚‡","ã¸ã‚“ã—ã‚…ã†","ã»ãã‚“","ã•ãã˜ã‚‡","ã“ã´ãƒ¼","ã¯ã‚Šã¤ã‘","ã„ã‚“ã•ã¤",
"ã²ã‚‡ã†ã˜","ã²ã²ã‚‡ã†ã˜","ã“ã†ã—ã‚“","ã©ã†ã","ã›ã¤ãã","ã›ã¤ã ã‚“","ãã©ã†","ã—ã‚…ã†ã‚Šã‚‡ã†","ã•ã„ãã©ã†","ã›ã£ã¦ã„",
"ã’ã‚“ã”","ã«ã»ã‚“ã”","ãˆã„ã”","ã¡ã‚…ã†ã”ãã”","ã‹ã‚“ã“ãã”","ã»ã‚“ã‚„ã","ã¤ã†ã‚„ã","ã‹ã„ã‚","ã‚ã„ã•ã¤","ã—ã‚‡ã†ã‹ã„",
"ãªã¾ãˆ","ã˜ã‚…ã†ã—ã‚‡","ã§ã‚“ã‚ã°ã‚“ã”ã†","ã‚ãƒ¼ã‚‹","ã‚Œã‚“ã‚‰ã","ã‚ã‚“ãªã„ã˜ã‚‡ã†","ã—ã‚‡ã†ãŸã„","ã—ã‚…ã£ã›ã","ã‘ã£ã›ã","ã•ã‚“ã‹",
"ã‹ã„ã","ã†ã¡ã‚ã‚ã›","ãã ã„","ãã˜ã‚ã","ã¯ã£ã´ã‚‡ã†","ã»ã†ã“ã","ã¦ã„ã—ã‚…ã¤ã¶ã¤","ã²ã‚‡ã†ã‹","ã•ã„ã‚ˆã†","ãŸã„ã—ã‚‡ã",
"ãã‚…ã†ã‹","ã‚†ã†ãã‚…ã†","ã‚€ãã‚…ã†","ãã‚“ã‚€","ã—ã‚…ã£ãã‚“","ã¡ã“ã","ãã†ãŸã„","ã–ã‚“ãã‚‡ã†","ãã‚…ã†ãã‚‡ã†","ã—ã‚‡ã†ã—ã‚“",
"ãŸã„ã—ã‚‡ããã‚“","ã­ã‚“ãã‚“","ãœã„ãã‚“","ã—ã‚“ã“ã","ã‚Šã‚‡ã†ã„ã","ã¶ã‚“ã‚„","ãã‚‡ã†ã‚€","ãŸã‚“ã¨ã†","ã‹ã ã„","ã‹ã„ã‘ã¤",
"ã—ã‚ˆã†","ã›ã£ã‘ã„","ã‹ã„ã¯ã¤","ã˜ã£ãã†","ã¦ã™ã¨","ã§ã°ã£ã","ã†ã‚“ã‚ˆã†","ã»ã—ã‚…","ã‹ã‚“ã—","ã‚ã",
"ã§ãƒ¼ãŸ","ã¶ã‚“ã›ã","ã‘ã£ã‹","ã›ã„ã›ã","ã¨ã†ã‘ã„","ã‘ã„ã“ã†","ãã†ã‹","ã’ã‚“ã—ã‚‡ã†","ã¸ã„ãã‚“","ã¡ã‚…ã†ãŠã†ã¡",
"ã•ã„ã ã„","ã•ã„ã—ã‚‡ã†","ã‚ã‚Šã‚ã„","ã²ã‚Šã¤","ã¶ã‚“ã‚‹ã„","ã‘ã‚“ã•ã","ã—ã‚…ã¨ã","ãã†ã—ã‚“","ã˜ã‚…ã—ã‚“","ã—ã‚‡ã‚Š",
"ã‹ã‚“ã™ã†","ã¸ã‚“ã™ã†","ã¯ã„ã‚Œã¤","ãŠã¶ã˜ã‡ãã¨","ãã‚‰ã™","ã‘ã„ã—ã‚‡ã†","ã‚Œã„ãŒã„","ã©ã†ã","ã²ã©ã†ã","ã¸ã„ã‚Œã¤",
"ãŒã‚ã‚“","ã¼ãŸã‚“","ã«ã‚…ã†ã‚Šã‚‡ã","ã—ã‚…ã¤ã‚Šã‚‡ã","ã›ã‚“ãŸã","ã‚Šã™ã¨","ã‚ã«ã‚…ãƒ¼","ãŸã¶","ã™ãã‚ãƒ¼ã‚‹","ã‚Œã™ã½ã‚“ã—ã¶"
]; 
// 4æ–‡å­—æœªæº€ã®å˜èªã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦æ–°ã—ã„ãƒªã‚¹ãƒˆã‚’ä½œæˆ
const WORDS = ORIGINAL_WORDS.filter(word => Array.from(word).length >= 4);

// è¨±å¯ã•ã‚ŒãŸã‚¢ãƒŠã‚°ãƒ©ãƒ ãƒšã‚¢ã‚’å®šç¾© (å…ƒã®å˜èªã‚’ã‚­ãƒ¼ã€è¨±å®¹ã•ã‚Œã‚‹ã‚¢ãƒŠã‚°ãƒ©ãƒ ã‚’å€¤ã¨ã™ã‚‹)
const ANAGRAM_ALLOWANCES = {
    "ãŸã„ã˜ã‚…ã†": ["ã˜ã‚…ã†ãŸã„"], // ä½“é‡ ã¨ æ¸‹æ»
    "ã„ã‘ã‚“": ["ã‘ã‚“ã„"],       // æ„è¦‹ ã¨ æ¨©å¨
    "ã›ã„ã“ã†": ["ã“ã†ã›ã„"],     // æˆåŠŸ ã¨ å…¬æ­£/æ§‹æˆ
    "ã¡ã‚…ã†ã„": ["ã„ã¡ã‚…ã†"]      // æ³¨æ„ ã¨ æ„ä¸­
    // ä»–ã«ã‚‚ã‚¢ãƒŠã‚°ãƒ©ãƒ ãŒã‚ã‚Œã°ã“ã“ã«è¿½åŠ ã—ã¾ã™
};

// ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®æœ€å¤§å•é¡Œæ•°ã‚’æ›´æ–°
const MAX_PROBLEMS = WORDS.length;


/* ===== ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ===== */
let currentIndex = -1;
let usedIndices = new Set();
let correctCount = 0;
let startTime = null;
let timerInterval = null;
const maxProblems = MAX_PROBLEMS; // æœ€å¤§å•é¡Œã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã®å˜èªæ•°ã«è¨­å®š
let locked = false; // å•é¡ŒãŒãƒ­ãƒƒã‚¯ï¼ˆã“ãŸãˆè¡¨ç¤ºãªã©ï¼‰
let currentWordLength = 0; // ç¾åœ¨ã®å•é¡Œã®æ–‡å­—æ•°

/* ===== DOM ===== */
const statusEl = document.getElementById('status');
const scrambledEl = document.getElementById('scrambled');
const answerArea = document.getElementById('answerArea');
const feedback = document.getElementById('feedback');
const timerEl = document.getElementById('timer');
const correctCountEl = document.getElementById('correctCount');
const remainingEl = document.getElementById('remaining');
const confirmBtn = document.getElementById('confirmBtn');

document.getElementById('startBtn').addEventListener('click', startGame);
document.getElementById('nextBtn').addEventListener('click', nextProblem);
confirmBtn.addEventListener('click', () => confirmAnswer(false)); // æ‰‹å‹•ç¢ºå®š
document.getElementById('clearBtn').addEventListener('click', clearAnswer);
document.getElementById('shuffleBtn').addEventListener('click', shuffleScrambled);
document.getElementById('revealBtn').addEventListener('click', revealAnswer);

/* ===== ãƒ˜ãƒ«ãƒ‘ãƒ¼ ===== */
function formatTime(sec){
  const m = String(Math.floor(sec/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  return m + ':' + s;
}
function startTimer(){
  startTime = Date.now();
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    const sec = Math.floor((Date.now() - startTime)/1000);
    timerEl.textContent = "ã˜ã‹ã‚“: " + formatTime(sec);
  },500);
}
function stopTimer(){ if(timerInterval){ clearInterval(timerInterval); timerInterval = null; } }

/* ===== é…åˆ—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
}
/* æ­£ç¢ºãª1æ–‡å­—åˆ†è§£ï¼ˆã‚µãƒ­ã‚²ãƒ¼ãƒˆå¯¾å¯¾å¿œï¼‰ */
function splitChars(str){ return Array.from(str); }

/* ç¢ºå®šãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ */
function updateConfirmButtonState(){
  // æ–‡å­—æ•°ãŒä¸€è‡´ã—ã€ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆã«æœ‰åŠ¹
  const selectedCharCount = answerArea.children.length;
  confirmBtn.disabled = locked || (selectedCharCount !== currentWordLength) || (currentWordLength === 0);
}

/* æ–‡å­—é¸æŠï¼ˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ï¼‰ã®ãƒ­ã‚¸ãƒƒã‚¯ */
function selectChar(btn, char){
  if(locked) return;
  if(btn.classList.contains('disabled')) return;
  
  btn.classList.add('disabled');
  
  const slot = createSlotElement(char, btn);
  answerArea.appendChild(slot);
  
  // feedbackã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒ’ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆã¯ç¶­æŒï¼‰
  if(!feedback.textContent.startsWith('ãƒ’ãƒ³ãƒˆ')){
     feedback.textContent = "ãƒ’ãƒ³ãƒˆï¼šã‚‚ã˜ã™ã† " + currentWordLength + " ã‚‚ã˜";
     feedback.style.color = 'var(--muted)';
  }
  
  updateConfirmButtonState();

  // è‡ªå‹•é€²è¡Œã®ãƒã‚§ãƒƒã‚¯
  if (answerArea.children.length === currentWordLength) {
    confirmAnswer(true); // isAutoConfirm: true ã‚’æ¸¡ã—ã¦è‡ªå‹•é€²è¡Œã‚’å¯èƒ½ã«ã™ã‚‹
  }
}

/* ã‚¹ãƒ­ãƒƒãƒˆã®DOMè¦ç´ ã‚’ç”Ÿæˆï¼ˆDnDã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ï¼‰ */
function createSlotElement(char, originalBtn){
    const slot = document.createElement('div');
    slot.className = 'slot';
    slot.textContent = char;
    slot.draggable = true; // ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹
    slot.dataset.char = char;
    
    // ã‚¹ãƒ­ãƒƒãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§æˆ»ã™å‡¦ç†
    slot.addEventListener('click', () => {
        if(locked) return;
        // è©²å½“ã™ã‚‹æ–‡å­—ã®disabledãƒœã‚¿ãƒ³ã‚’ä¸€ã¤æœ‰åŠ¹ã«æˆ»ã™
        const buttons = Array.from(scrambledEl.querySelectorAll('.char-btn'));
        for(const b of buttons){
            if(b.textContent === char && b.classList.contains('disabled')){
                b.classList.remove('disabled');
                break;
            }
        }
        slot.remove();
        updateConfirmButtonState();
    });

    /* --- ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— ã‚¤ãƒ™ãƒ³ãƒˆ --- */
    slot.addEventListener('dragstart', (e) => {
        if(locked) { e.preventDefault(); return; }
        e.dataTransfer.setData('text/plain', char);
        e.dataTransfer.effectAllowed = 'move';
        slot.classList.add('dragging');
        // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚¹ãƒ­ãƒƒãƒˆè‡ªä½“ã®å‚ç…§ã‚’ä¿æŒ
        e.dataTransfer.setData('sourceId', 'slot-drag'); // ä»»æ„ã®è­˜åˆ¥å­
        e.dataTransfer.setData('sourceIndex', Array.from(answerArea.children).indexOf(slot));
    });

    slot.addEventListener('dragend', () => {
        slot.classList.remove('dragging');
    });

    // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆã‚¹ãƒ­ãƒƒãƒˆè‡ªä½“ï¼‰
    slot.addEventListener('dragover', (e) => {
        if(locked) { e.preventDefault(); return; }
        e.preventDefault(); // ãƒ‰ãƒ­ãƒƒãƒ—ã‚’è¨±å¯
        if(e.currentTarget !== slot.parentElement) { // è¦ªè¦ç´ ä»¥å¤–ã§ãªã‘ã‚Œã°
            slot.classList.add('drag-over');
        }
    });

    slot.addEventListener('dragleave', (e) => {
        if(locked) return;
        slot.classList.remove('drag-over');
    });

    slot.addEventListener('drop', (e) => {
        if(locked) return;
        e.preventDefault();
        slot.classList.remove('drag-over');

        const draggedIndex = parseInt(e.dataTransfer.getData('sourceIndex'));
        const droppedElement = answerArea.children[draggedIndex];
        const targetElement = e.currentTarget;

        if (droppedElement && targetElement && droppedElement !== targetElement) {
            // ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸè¦ç´ ã®ä½ç½®ã‚’å–å¾—
            const targetIndex = Array.from(answerArea.children).indexOf(targetElement);

            // è¦ç´ ã‚’ç§»å‹•
            if (draggedIndex < targetIndex) {
                // å¾Œã‚ã«ç§»å‹•ã™ã‚‹å ´åˆ: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦ç´ ã®å¾Œã«æŒ¿å…¥
                answerArea.insertBefore(droppedElement, targetElement.nextSibling);
            } else {
                // å‰ã«ç§»å‹•ã™ã‚‹å ´åˆ: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦ç´ ã®å‰ã«æŒ¿å…¥
                answerArea.insertBefore(droppedElement, targetElement);
            }
        }
        
        // DnDå¾Œã®è‡ªå‹•ç¢ºå®šãƒã‚§ãƒƒã‚¯
        if (answerArea.children.length === currentWordLength) {
            confirmAnswer(true); // isAutoConfirm: true ã‚’æ¸¡ã—ã¦è‡ªå‹•é€²è¡Œã‚’å¯èƒ½ã«ã™ã‚‹
        }
    });

    return slot;
}


/* answerAreaï¼ˆè¦ªè¦ç´ ï¼‰ã®DnDã‚¤ãƒ™ãƒ³ãƒˆ */
answerArea.addEventListener('dragover', (e) => {
    if(locked) { e.preventDefault(); return; }
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
});

/* ===== å•é¡Œç”Ÿæˆ / è¡¨ç¤º ===== */
function pickRandomUnused(){
  if(usedIndices.size >= maxProblems) return -1;
  let idx;
  do{
    idx = Math.floor(Math.random() * WORDS.length);
  }while(usedIndices.has(idx));
  usedIndices.add(idx);
  return idx;
}

function renderProblem(word){
  // åˆæœŸåŒ–
  locked = false;
  answerArea.innerHTML = '';
  scrambledEl.innerHTML = '';
  feedback.textContent = '';
  confirmBtn.disabled = true;

  // ãƒ’ãƒ³ãƒˆï¼ˆæ–‡å­—æ•°ï¼‰
  const chars = splitChars(word);
  currentWordLength = chars.length;
  document.querySelector('.hint')?.setAttribute('aria-hidden','false');
  
  // è¡¨ç¤ºï¼šæœªé¸æŠã®ãƒœã‚¿ãƒ³è¦ç´ ã‚’ä½œã‚‹
  const btnElems = chars.slice().map(ch => {
    const btn = document.createElement('button');
    btn.className = 'char-btn';
    btn.type = 'button';
    btn.textContent = ch;
    // ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ
    btn.addEventListener('click', () => selectChar(btn, ch));
    return btn;
  });

  // ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆï¼ˆè¦ç´ ãã®ã‚‚ã®ã‚’ãƒ©ãƒ³ãƒ€ãƒ é †ã§appendã™ã‚‹ï¼‰
  shuffleArray(btnElems);
  btnElems.forEach((b, index) => {
     // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒ‡ãƒ¼ã‚¿å±æ€§ã¨ã—ã¦è¿½åŠ 
     b.dataset.index = index + 1;
     scrambledEl.appendChild(b);
  });

  // ãƒ’ãƒ³ãƒˆè¡¨ç¤ºï¼ˆæ–‡å­—æ•°ï¼‰
  const hintText = "ãƒ’ãƒ³ãƒˆï¼šã‚‚ã˜ã™ã† " + chars.length + " ã‚‚ã˜";
  feedback.textContent = hintText;
  feedback.style.color = 'var(--muted)';
  updateConfirmButtonState();
}

/* ç¾åœ¨ã®é¸æŠæ–‡å­—åˆ—ã‚’å–å¾— */
function getCurrentAnswer(){
  // DnDã§ä¸¦ã¹æ›¿ãˆã‚‰ã‚ŒãŸå¾Œã®ã‚¹ãƒ­ãƒƒãƒˆã®textContentã‚’å–å¾—
  return Array.from(answerArea.children).map(n=>n.textContent).join('');
}

/* ç¢ºå®šå‡¦ç† */
function confirmAnswer(isAutoConfirm = false){
  if(currentIndex < 0 || locked) return;
  if(answerArea.children.length !== currentWordLength) return; 

  const correct = WORDS[currentIndex];
  const user = getCurrentAnswer();
  
  let isCorrect = (user === correct); // ã¾ãšã¯å…ƒã®æ­£è§£ã‚’ãƒã‚§ãƒƒã‚¯

  // 1. ã‚¢ãƒŠã‚°ãƒ©ãƒ è¨±å®¹ãƒã‚§ãƒƒã‚¯: å…ƒã®æ­£è§£ã§ã¯ãªã„ãŒã€è¨±å®¹ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹
  if (!isCorrect) {
      const allowances = ANAGRAM_ALLOWANCES[correct];
      if (allowances && allowances.includes(user)) {
          isCorrect = true; // è¨±å®¹ã‚¢ãƒŠã‚°ãƒ©ãƒ ã¨ã—ã¦æ­£è§£
      }
  }

  
  if(isCorrect){
    feedback.textContent = "ã›ã„ã‹ã„ï¼ ğŸ‰";
    feedback.style.color = "var(--correct)";
    correctCount++;
    
    // æ­£è§£ã®å ´åˆã€é…å»¶ã‚’å…¥ã‚Œã¦æ¬¡ã®å•é¡Œã¸è‡ªå‹•é·ç§»ã™ã‚‹
    if (isAutoConfirm) {
        locked = true; // ãƒ­ãƒƒã‚¯ã‚’ã‹ã‘ã¦ã€æ¬¡ã®å•é¡Œã¸é€²ã‚€ã¾ã§ã®æ“ä½œã‚’é˜²ã
        setTimeout(() => {
            nextProblem(); // 1ç§’å¾Œã«æ¬¡ã®å•é¡Œã¸
        }, 1000);
    } else {
        // æ‰‹å‹•ç¢ºå®šã®å ´åˆã€æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ã‚’å¼·èª¿ï¼ˆå…ƒã®å‹•ä½œï¼‰
        document.getElementById('nextBtn').classList.remove('secondary');
        document.getElementById('nextBtn').style.background = 'var(--accent)';
        document.getElementById('nextBtn').style.color = '#fff';
        locked = true; // ãƒ­ãƒƒã‚¯ã‚’ã‹ã‘ã‚‹
    }

  } else {
    // 2. ä¸æ­£è§£ã®å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª¿æ•´
    let feedbackMessage = "ãµã›ã„ã‹ã„ï¼ ã›ã„ã‹ã„ã¯ã€Œ" + correct + "ã€ã§ã—ãŸã€‚";
    
    // ã‚¢ãƒŠã‚°ãƒ©ãƒ è¨±å®¹ãƒªã‚¹ãƒˆã«è¼‰ã£ã¦ã„ã‚‹å˜èªãŒå…ƒã®æ­£è§£ã ã£ãŸå ´åˆã€è¨±å®¹ã•ã‚Œã‚‹åˆ¥ã®å˜èªã‚‚ä½µè¨˜ã™ã‚‹
    if(ANAGRAM_ALLOWANCES[correct]){
        feedbackMessage += " (ã¾ãŸã¯ã€Œ" + ANAGRAM_ALLOWANCES[correct].join("ã€, ã€Œ") + "ã€)";
    }

    feedback.textContent = feedbackMessage;
    feedback.style.color = "var(--wrong)";
    locked = true; // ä¸æ­£è§£ã®å ´åˆã¯ãƒ­ãƒƒã‚¯
  }
  
  confirmBtn.disabled = true; // ç„¡åŠ¹åŒ–
  updateStatus();
}

/* ã‚¯ãƒªã‚¢ */
function clearAnswer(){
  if(locked) return;
  // answerAreaå†…ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’é€†é †ã§å‡¦ç†ã—ã€å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
  const slots = Array.from(answerArea.children);
  const buttons = Array.from(scrambledEl.querySelectorAll('.char-btn'));

  slots.forEach(slot => {
    const char = slot.textContent;
    // è©²å½“ã™ã‚‹æ–‡å­—ã®disabledãƒœã‚¿ãƒ³ã‚’ä¸€ã¤æœ‰åŠ¹ã«æˆ»ã™
    for(const b of buttons){
      if(b.textContent === char && b.classList.contains('disabled')){
        b.classList.remove('disabled');
        break;
      }
    }
  });

  answerArea.innerHTML = '';
  // feedbackã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒ’ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆã¯ç¶­æŒï¼‰
  if(!feedback.textContent.startsWith('ãƒ’ãƒ³ãƒˆ')){
     feedback.textContent = "ãƒ’ãƒ³ãƒˆï¼šã‚‚ã˜ã™ã† " + currentWordLength + " ã‚‚ã˜";
     feedback.style.color = 'var(--muted)';
  }
  updateConfirmButtonState();
}

/* ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆæœªé¸æŠã®ãƒœã‚¿ãƒ³è¦ç´ ã ã‘å…¥ã‚Œæ›¿ãˆã‚‹ï¼‰ */
function shuffleScrambled(){
  if(locked) return;
  // é¸æŠæ¸ˆã¿ã®ãƒœã‚¿ãƒ³ã¯ disabled ã«ãªã£ã¦ã„ã‚‹ã€‚æœªé¸æŠãƒœã‚¿ãƒ³ã ã‘ã‚’æŠ½å‡ºã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å†é…ç½®ã™ã‚‹
  const allBtns = Array.from(scrambledEl.querySelectorAll('.char-btn'));
  const unselected = allBtns.filter(b => !b.classList.contains('disabled'));
  if(unselected.length <= 1) return;
  
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦ã‹ã‚‰ã€å…ƒã®ä¸¦ã³é †ã«æˆ»ã™å‡¦ç†ã§å†é…ç½®
  shuffleArray(unselected);
  
  // å†æ§‹ç¯‰ï¼šå…ƒã®ä¸¦ã³ï¼ˆallBtnsï¼‰ã‚’åŸºæº–ã«ã—ã€å„ä½ç½®ã« disabled ãªã‚‰ãã®disabledè¦ç´ ã‚’ã€æœªé¸æŠãªã‚‰ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ãŸé…åˆ—ã‹ã‚‰é †ã«å…¥ã‚Œã‚‹
  const newOrder = [];
  let uIdx = 0;
  for(const orig of allBtns){
    if(orig.classList.contains('disabled')){
      newOrder.push(orig);
    } else {
      // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ›´æ–°ã—ã€æ–°ã—ã„è¦ç´ ã‚’æŒ¿å…¥
      unselected[uIdx].dataset.index = newOrder.length + 1; 
      newOrder.push(unselected[uIdx++]);
    }
  }
  
  // ã‚¯ãƒªã‚¢ã—ã¦å†append
  scrambledEl.innerHTML = '';
  newOrder.forEach(el => scrambledEl.appendChild(el));
}

/* ã€Œã“ãŸãˆã€è¡¨ç¤ºï¼ˆæ­£è§£ã‚’ã‚¹ãƒ­ãƒƒãƒˆã«è‡ªå‹•ã§å…¥ã‚Œã‚‹ï¼‰ */
function revealAnswer(){
  if(currentIndex < 0) return;
  
  // ãƒ­ãƒƒã‚¯ã—ã¦æ—¢å­˜é¸æŠã¯ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰è¡¨ç¤ºã™ã‚‹
  clearAnswer();
  const correct = WORDS[currentIndex];
  const chars = splitChars(correct);
  
  // disabledã«ã—ã¦ã‚¹ãƒ­ãƒƒãƒˆã«å…¥ã‚Œã‚‹
  const buttons = Array.from(scrambledEl.querySelectorAll('.char-btn'));
  
  // æ­£ã—ã„é †ã«ã‚¹ãƒ­ãƒƒãƒˆã‚’ä½œæˆã—ã€å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ disabled ã«ã™ã‚‹
  chars.forEach(ch => {
    for(const b of buttons){
      if(!b.classList.contains('disabled') && b.textContent === ch){
        b.classList.add('disabled');
        // ã‚¹ãƒ­ãƒƒãƒˆã‚’ä½œæˆã—ã€answerAreaã«è¿½åŠ 
        const slot = createSlotElement(ch, b); 
        slot.draggable = false; // ç­”ãˆè¡¨ç¤ºæ™‚ã¯ä¸¦ã¹æ›¿ãˆã‚’ç¦æ­¢
        answerArea.appendChild(slot);
        break;
      }
    }
  });
  
  // ç­”ãˆè¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚èª¿æ•´
  let feedbackMessage = "ã›ã„ã‹ã„ã‚’ã²ã‚‡ã†ã˜ã—ã¾ã—ãŸã€‚æ­£è§£ã¯ã€Œ" + correct + "ã€";
  if(ANAGRAM_ALLOWANCES[correct]){
      feedbackMessage += " (ã¾ãŸã¯ã€Œ" + ANAGRAM_ALLOWANCES[correct].join("ã€, ã€Œ") + "ã€)";
  }

  feedback.textContent = feedbackMessage;
  feedback.style.color = "var(--muted)";
  locked = true;
  confirmBtn.disabled = true; // ç„¡åŠ¹åŒ–
}

/* æ¬¡ã®å•é¡Œ */
function nextProblem(){
  // æ­£è§£å¾Œã®ãƒœã‚¿ãƒ³å¼·èª¿ã‚’å…ƒã«æˆ»ã™
  document.getElementById('nextBtn').classList.add('secondary');
  document.getElementById('nextBtn').style.background = '';
  document.getElementById('nextBtn').style.color = '';

  if(usedIndices.size >= maxProblems){
    feedback.textContent = "ãœã‚“ã¶ã®ã‚‚ã‚“ã ã„ãŒã—ã‚…ã†ã‚Šã‚‡ã†ã—ã¾ã—ãŸã€‚ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼";
    stopTimer();
    return;
  }
  
  const idx = pickRandomUnused();
  if(idx === -1){
    feedback.textContent = "ã“ã‚Œã„ã˜ã‚‡ã†ã—ã‚…ã¤ã ã„ã§ãã¾ã›ã‚“ã€‚";
    return;
  }
  
  currentIndex = idx;
  renderProblem(WORDS[idx]);
  updateStatus();
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° */
function updateStatus(){
  document.getElementById('status').textContent = "ã‚‚ã‚“ã ã„: " + usedIndices.size + " / " + maxProblems;
  if(remainingEl){
    remainingEl.textContent = Math.max(0, maxProblems - usedIndices.size);
  }
  correctCountEl.textContent = correctCount;
}

/* ã‚¹ã‚¿ãƒ¼ãƒˆ */
function startGame(){
  usedIndices = new Set();
  correctCount = 0;
  correctCountEl.textContent = "0";
  // feedbackã‚’ãƒªã‚»ãƒƒãƒˆ
  feedback.textContent = '';
  startTimer();
  nextProblem();
}

/* åˆæœŸåŒ– */
updateStatus();
timerEl.textContent = "ã˜ã‹ã‚“: 00:00";

/* ===== ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®å¼·åŒ– ===== */
document.addEventListener('keydown', (e) => {
  if(locked) return;
  
  // Enter: ç¢ºå®š
  if(e.key === 'Enter'){
    if(!confirmBtn.disabled) confirmAnswer(false); // isAutoConfirm: false (æ‰‹å‹•ç¢ºå®š)
  }
  
  // Backspace: ã‚¯ãƒªã‚¢
  if(e.key === 'Backspace'){
    e.preventDefault(); // ãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹å‹•ä½œã‚’ç„¡åŠ¹åŒ–
    clearAnswer();
  }
  
  // æ•°å­—ã‚­ãƒ¼ (1, 2, 3...) ã§æ–‡å­—ã‚’é¸æŠ
  const number = parseInt(e.key);
  if(number >= 1 && number <= 9){
    e.preventDefault();
    const btnToSelect = scrambledEl.querySelector(`.char-btn[data-index="${number}"]`);
    if(btnToSelect && !btnToSelect.classList.contains('disabled')){
      // å¯¾å¿œã™ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒœã‚¿ãƒ³ãŒã‚ã‚Œã°ã‚¯ãƒªãƒƒã‚¯ï¼ˆé¸æŠï¼‰
      btnToSelect.click();
    }
  }
});
</script>
</body>
</html>
